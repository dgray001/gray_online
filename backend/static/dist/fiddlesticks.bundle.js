"use strict";(self.webpackChunkgray_online=self.webpackChunkgray_online||[]).push([[398],{7868:(t,e,i)=>{i.d(e,{Z:()=>d});var a=i(8081),r=i.n(a),s=i(3645),n=i.n(s)()(r());n.push([t.id,"dwg-fiddlesticks{--height-players-cards: 182px;--width-messages: 180px;--size-player: 130px;--table-diameter: min( calc(var(--game-height) - var(--height-players-cards) - var(--size-player)), calc(var(--game-width) - 2 * var(--width-messages)) );background-color:var(--color-background);display:block;height:100%;position:relative;width:100%}dwg-fiddlesticks>#header-messages-container{--width: calc(var(--width-messages) - 2em);font-size:var(--font-size-medium);left:calc(.5*(100% - var(--table-diameter)) - var(--width-messages) + .2em);line-height:1.7em;position:absolute;top:1em;width:var(--width)}dwg-fiddlesticks>#header-messages-container>* .span-align{display:inline-block;text-align:right;width:50%}dwg-fiddlesticks>#header-messages-container>* .span-center{display:block;margin-top:.6em;text-align:center;text-decoration:underline}dwg-fiddlesticks>#trump-card-container{--line-height: 1.7em;--width: calc(var(--width-messages) - 2em);--height: calc(var(--line-height) + var(--card-image-scale) * var(--width));border-radius:.4em;left:calc(1.8em + .5*(100% + var(--table-diameter)));line-height:var(--line-height);font-size:var(--font-size-medium);height:var(--height);position:absolute;text-align:center;top:1em;width:var(--width)}dwg-fiddlesticks>#trump-card-container>#trump-text{border-radius:.4em;letter-spacing:1.2px}dwg-fiddlesticks>#trump-card-container>#trump-card{height:calc(var(--card-image-scale)*var(--width));position:absolute;top:var(--line-height);width:var(--width)}dwg-fiddlesticks>#trump-card-container>#trump-card>#trump-card-img{height:100%;width:100%}dwg-fiddlesticks>#trump-card-container>#trump-card>#trump-card-img:not(.show){display:none}dwg-fiddlesticks>#table-container{background-position:center;background-repeat:no-repeat;background-size:contain;height:var(--table-diameter);left:calc(.5*(100% - var(--table-diameter)));position:absolute;top:calc(.5*var(--size-player));width:var(--table-diameter)}dwg-fiddlesticks>#table-container>#trick-cards{--width: min(125px, calc(0.18 * var(--table-diameter)));--height: calc(var(--card-image-scale) * var(--width));--num-players: 0;--winner: 0;--winner-rotation: calc((var(--winner) / var(--num-players)) * 1turn);--winner-turns: calc(var(--winner-rotation) + 0.25turn);--x-winner: calc(0.5 * (var(--table-diameter) + var(--table-diameter) * cos(var(--winner-turns))) - 0.5 * var(--width));--y-winner: calc(0.5 * (var(--table-diameter) + var(--table-diameter) * sin(var(--winner-turns))) - 0.5 * var(--height))}dwg-fiddlesticks>#table-container>#trick-cards>.card{--i: 0;--rotation: calc((var(--i) / var(--num-players)) * 1turn);--turns: calc(var(--rotation) + 0.25turn);--x-start: calc(0.5 * (var(--table-diameter) + var(--table-diameter) * cos(var(--turns))) - 0.5 * var(--width));--y-start: calc(0.5 * (var(--table-diameter) + var(--table-diameter) * sin(var(--turns))) - 0.5 * var(--height));--x-played: calc(0.5 * (var(--table-diameter) + var(--height) * cos(var(--turns))) - 0.5 * var(--width));--y-played: calc(0.5 * (var(--table-diameter) + var(--height) * sin(var(--turns))) - 0.5 * var(--height));--x-center: calc(0.5 * var(--table-diameter) - 0.5 * var(--width));--y-center: calc(0.5 * var(--table-diameter) - 0.5 * var(--height));display:block;height:var(--height);left:var(--x-start);position:absolute;top:var(--y-start);transform:rotate(var(--rotation));transition-duration:0s;transition-property:left,top,transform;transition-timing-function:ease-out;width:var(--width)}dwg-fiddlesticks>#table-container>#trick-cards>.card.played{left:var(--x-played);top:var(--y-played)}dwg-fiddlesticks>#table-container>#trick-cards>.card.center{left:var(--x-center);top:var(--y-center)}dwg-fiddlesticks>#table-container>#trick-cards>.card.winner{left:var(--x-winner);top:var(--y-winner);transform:rotate(var(--winner-rotation))}dwg-fiddlesticks>#table-container>#trick-cards>.card>img{height:100%;width:100%}dwg-fiddlesticks>#player-container{height:var(--table-diameter);left:calc(.5*(100% - var(--table-diameter)));position:absolute;top:calc(.5*var(--size-player));width:var(--table-diameter)}dwg-fiddlesticks>#player-container>dwg-fiddlesticks-player{--diameter: var(--table-diameter);--size: var(--size-player);height:var(--size);width:var(--size)}dwg-fiddlesticks>#players-cards{--width: min(calc(var(--table-diameter) + 2 * var(--width-messages)), 100%);height:var(--height-players-cards);left:calc(.5*(100% - var(--width)));position:absolute;top:calc(var(--size-player) + var(--table-diameter));width:var(--width);z-index:4}body.mobile dwg-fiddlesticks{--height-players-cards: min(120px, 18svh);--width-messages: calc(0.5 * var(--game-width));--height-messages: calc(5 * 1.7em + 0.6em);--size-player: min(90px, 13svh);--messages-gap: var(--font-size-smallest);--table-diameter: min( calc(var(--game-height) - var(--height-players-cards) - var(--size-player) - var(--height-messages) - var(--messages-gap)), calc(var(--game-width) - var(--size-player)) );--total-height: calc(var(--height-messages) + var(--messages-gap) + var(--table-diameter) + var(--size-player) + var(--height-players-cards));--leftover-height: calc(var(--game-height) - var(--total-height));--margin-top: max(0px, max(calc(var(--leftover-height) - 5em), calc(0.5 * var(--leftover-height))));font-size:var(--font-size-smaller)}body.mobile dwg-fiddlesticks>#header-messages-container{font-size:var(--font-size-smallest);left:1em;top:calc(.7*var(--margin-top))}body.mobile dwg-fiddlesticks>#trump-card-container{--height: var(--height-messages);font-size:var(--font-size-smallest);left:calc(1em + var(--width-messages));top:calc(.7*var(--margin-top))}body.mobile dwg-fiddlesticks>#trump-card-container>#trump-text{border-radius:.4em;letter-spacing:1.2px}body.mobile dwg-fiddlesticks>#trump-card-container>#trump-card{--height-trump: calc(var(--height-messages) - var(--line-height));--width-trump: calc(var(--height-trump) / var(--card-image-scale));height:var(--height-trump);left:calc(.5*(var(--width-messages) - 2em - var(--width-trump)));width:var(--width-trump)}body.mobile dwg-fiddlesticks>#trump-card-container>#trump-card>#trump-card-img{height:100%;width:100%}body.mobile dwg-fiddlesticks>#trump-card-container>#trump-card>#trump-card-img:not(.show){display:none}body.mobile dwg-fiddlesticks>#table-container{left:calc(.5*(var(--game-width) - var(--table-diameter)));top:calc(var(--margin-top) + var(--height-messages) + var(--messages-gap) + .5*var(--size-player))}body.mobile dwg-fiddlesticks>#player-container{left:calc(.5*(var(--game-width) - var(--table-diameter)));top:calc(var(--margin-top) + var(--height-messages) + var(--messages-gap) + .5*var(--size-player))}body.mobile dwg-fiddlesticks>#players-cards{--width: var(--game-width);left:0;top:calc(var(--margin-top) + var(--height-messages) + var(--messages-gap) + var(--size-player) + var(--table-diameter))}",""]);const d=n},8561:(t,e,i)=>{i.d(e,{Z:()=>d});var a=i(8081),r=i.n(a),s=i(3645),n=i.n(s)()(r());n.push([t.id,"dwg-fiddlesticks-player{--order: 0;--num-players: 0;--turns: calc((0.25 + var(--order) / var(--num-players)) * 1turn);--x: calc(0.5 * var(--diameter) * (1 + cos(var(--turns))) - 0.5 * var(--size));--y: calc(0.5 * var(--diameter) * (1 + sin(var(--turns))) - 0.5 * var(--size));--icon-size: 64px;--turn-color: rgba(90, 10, 240, 0.8);--background-color: rgba(240, 240, 240, 0.7);display:block;left:var(--x);position:absolute;top:var(--y)}dwg-fiddlesticks-player.turn{background:conic-gradient(var(--background-color) var(--turn-left), --turn-color);box-shadow:0 0 8px 2px var(--turn-color)}dwg-fiddlesticks-player>#wrapper{background-color:var(--background-color);border-radius:calc(.08*var(--size));color:#000;display:block;z-index:4}dwg-fiddlesticks-player>#wrapper>*{box-sizing:border-box;font-size:calc(.13*var(--size));height:calc(.2*var(--size));line-height:calc(.2*var(--size));width:100%}dwg-fiddlesticks-player>#wrapper>#name-container{font-weight:bold;padding:.3em .4em .2em;text-align:center}dwg-fiddlesticks-player>#wrapper>#status-container{padding-left:.3em;text-align:center}dwg-fiddlesticks-player>#wrapper .fixed-width{display:inline-block;padding:0 .2em;text-align:right;width:40%}dwg-fiddlesticks-player>#wrapper #bet-input-wrapper{--height: calc(0.2 * var(--size));--gap: 5px;--padding: 0.5em;--total-height: calc(3 * var(--height) + 2 * var(--gap) + 2 * var(--padding));background-color:rgba(240,240,240,.6);border-radius:calc(.08*var(--size));box-shadow:0 0 6px 6px var(--turn-color);display:flex;flex-flow:column nowrap;font-size:calc(.13*var(--size));gap:var(--gap);height:var(--total-height);line-height:calc(.2*var(--size));padding:var(--padding);position:absolute;text-align:center;top:calc(-1.1*var(--total-height));width:100%;z-index:2}dwg-fiddlesticks-player>#wrapper #bet-input-wrapper:not(.show){display:none}dwg-fiddlesticks-player>#wrapper #bet-input-wrapper>*{flex:0 0 var(--height);height:var(--height);max-height:var(--height);min-height:var(--height)}dwg-fiddlesticks-player>#wrapper #bet-input-wrapper>#bet-input{font-size:calc(.13*var(--size))}dwg-fiddlesticks-player>#wrapper #bet-input-wrapper>#bet-button{font-size:calc(.18*var(--size));line-height:calc(.18*var(--size))}dwg-fiddlesticks-player>#wrapper #bet-animation{background-color:rgba(60,60,60,.7);border-radius:.5em;color:#fff;font-size:0;font-weight:bold;left:0px;margin:0 auto;padding:.5em;position:relative;text-align:center;top:calc(-1em - 6px);transition-property:font-size;transition-timing-function:ease;width:fit-content}dwg-fiddlesticks-player>#wrapper #bet-animation.transition{font-size:var(--font-size-largest)}dwg-fiddlesticks-player>#wrapper>.icon-wrapper{height:var(--icon-size);left:min(10%,10px);opacity:75%;position:absolute;top:calc(-0.75*var(--icon-size));width:var(--icon-size)}dwg-fiddlesticks-player>#wrapper>.icon-wrapper:not(.show){display:none}dwg-fiddlesticks-player>#wrapper>.icon-wrapper>.icon{height:100%;rotate:-30deg;width:100%}dwg-fiddlesticks-player>#wrapper>.icon-wrapper>.icon-tooltip{background-color:rgba(60,60,60,.95);border-radius:.6em;bottom:-1em;color:#fff;padding:.2em .4em;position:absolute;transition:opacity .5s;user-select:none;white-space:nowrap}dwg-fiddlesticks-player>#wrapper>.icon-wrapper:not(:hover)>.icon-tooltip{opacity:0%}body.mobile dwg-fiddlesticks-player{--icon-size: 40px}body.mobile dwg-fiddlesticks-player>#wrapper>.icon-wrapper.show-tooltip>.icon-tooltip{opacity:100%}",""]);const d=n},3697:(t,e,i)=>{i.d(e,{Z:()=>d});var a=i(8081),r=i.n(a),s=i(3645),n=i.n(s)()(r());n.push([t.id,"dwg-card-hand{--height: 0;--width: 0;--play-drop-margin: 0;display:block;height:100%;width:100%}dwg-card-hand>#cards-container{--min-padding: 3px;--num-cards: 0;--card-width: calc((var(--height) - var(--min-padding)) / var(--card-image-scale));--card-overlap: min( calc(-0.3 * var(--card-width)), calc(((var(--width) - var(--card-width)) / (var(--num-cards) - 1)) - var(--card-width)) );--total-card-width: calc(var(--card-width) + (var(--num-cards) - 1) * (var(--card-width) + var(--card-overlap)));box-sizing:border-box;display:flex;flex-flow:row nowrap;height:calc(100% - var(--min-padding));justify-content:flex-start;margin-top:var(--min-padding);padding-left:max(var(--min-padding),.5*(var(--width) - var(--total-card-width)));width:100%}dwg-card-hand>#cards-container>.card{--i: 0;flex:0 0 var(--card-width);height:100%;max-width:var(--card-width);min-width:var(--card-width);order:var(--i);touch-action:none;transform:translateX(calc(var(--i) * var(--card-overlap))) rotate(-3deg);user-select:none;width:var(--card-width)}dwg-card-hand>#cards-container>.card.hovering{transform:translate(calc(var(--i) * var(--card-overlap)), calc(-0.1 * var(--height))) rotate(-1deg);z-index:3}dwg-card-hand>#cards-container>.card.dragging{transform:translate(calc(var(--i) * var(--card-overlap) + var(--x)), calc(-0.1 * var(--height) + var(--y)));z-index:3}dwg-card-hand>#cards-container>.card>img{height:100%;width:100%}dwg-card-hand>#play-drop{background-color:rgba(100,250,100,.15);height:100vh;left:-100vw;position:absolute;top:calc(-100vh - var(--play-drop-margin));width:200vw;z-index:2}dwg-card-hand>#play-drop.hovering{background-color:rgba(100,250,100,.3)}dwg-card-hand>#cancel-drop{background-color:rgba(250,100,100,.15);height:100vh;left:-100vw;position:absolute;top:calc(-1*var(--play-drop-margin));width:200vw;z-index:2}dwg-card-hand>#cancel-drop.hovering{background-color:rgba(250,100,100,.3)}dwg-card-hand:not(.dragging-playing)>#play-drop{display:none}dwg-card-hand:not(.dragging-playing)>#cancel-drop{display:none}",""]);const d=n},3704:(t,e,i)=>{var a=i(4268),r=i(5450),s=i(7820),n=i(7483),d=i(6442),o=i(3919),c=i(3379),l=i.n(c),h=i(7795),g=i.n(h),p=i(569),m=i.n(p),u=i(3565),v=i.n(u),y=i(9216),_=i.n(y),f=i(4589),w=i.n(f),b=i(7868),k={};k.styleTagTransform=w(),k.setAttributes=v(),k.insert=m().bind(null,"head"),k.domAPI=g(),k.insertStyleElement=_(),l()(b.Z,k),b.Z&&b.Z.locals&&b.Z.locals;class x{constructor(){this.sounds=new Map}static play(t){return e=this,i=void 0,r=function*(){try{let e=x.instance.sounds.get(t);e||(e=new Audio(`sounds/${t}.mp3`),x.instance.sounds.set(t,e)),yield e.play()}catch(t){console.error(t)}},new((a=void 0)||(a=Promise))((function(t,s){function n(t){try{o(r.next(t))}catch(t){s(t)}}function d(t){try{o(r.throw(t))}catch(t){s(t)}}function o(e){var i;e.done?t(e.value):(i=e.value,i instanceof a?i:new a((function(t){t(i)}))).then(n,d)}o((r=r.apply(e,i||[])).next())}));var e,i,a,r}}x.instance=new x;var z=i(7091),E=i.n(z),C=new URL(i(6619),i.b),T=new URL(i(721),i.b);const L='<div id="wrapper" class="max-size"> <div id="name-container"></div> <div id="status-container"></div> <div> <span class="fixed-width">Score:</span> <span id="score-container" class="right-data"></span> </div> <div> <span class="fixed-width">Bet:</span> <span id="bet-container" class="right-data"></span> <div id="bet-animation"></div> </div> <div> <span class="fixed-width">Tricks:</span> <span id="tricks-container" class="right-data"></span> </div> <div id="dealer-wrapper" class="icon-wrapper"> <img class="icon" alt="dealer" src="'+E()(C)+'"> <div class="icon-tooltip">Dealt Round</div> </div> <div id="winner-wrapper" class="icon-wrapper"> <img class="icon" alt="winner" src="'+E()(T)+'"> <div class="icon-tooltip">Won Game</div> </div> <div id="bet-input-wrapper"> <div id="bet-input-message">Place Bet</div> <input id="bet-input" type="number" placeholder="bet" min="0"> <button id="bet-button">Bet</button> </div> </div> ';var P=i(8561),S={};S.styleTagTransform=w(),S.setAttributes=v(),S.insert=m().bind(null,"head"),S.domAPI=g(),S.insertStyleElement=_(),l()(P.Z,S),P.Z&&P.Z.locals&&P.Z.locals;var $=function(t,e,i,a){return new(i||(i=Promise))((function(r,s){function n(t){try{o(a.next(t))}catch(t){s(t)}}function d(t){try{o(a.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,d)}o((a=a.apply(t,e||[])).next())}))};class D extends a.r{constructor(){super(),this.initialized=!1,this.client_player=!1,this.card_els=[],this.htmlString=L,this.configureElement("name_container"),this.configureElement("status_container"),this.configureElement("score_container"),this.configureElement("bet_container"),this.configureElement("bet_input_wrapper"),this.configureElement("bet_input"),this.configureElement("bet_button"),this.configureElement("tricks_container"),this.configureElement("dealer_wrapper"),this.configureElement("winner_wrapper"),this.configureElement("bet_animation")}parsedCallback(){if(!this.initialized)throw new Error("Should initialize fiddlesticks player before attaching to dom");let t,e;this.name_container.innerText=this.player.player.nickname,this.score_container.innerText=this.player.score.toString(),this.bet_container.innerText="-",this.tricks_container.innerText="-",this.dealer_wrapper.addEventListener("click",(()=>{t&&clearTimeout(t),this.dealer_wrapper.classList.toggle("show-tooltip"),this.dealer_wrapper.classList.contains("show-tooltip")&&(t=setTimeout((()=>{this.dealer_wrapper.classList.remove("show-tooltip")}),2e3))})),this.winner_wrapper.addEventListener("click",(()=>{e&&clearTimeout(e),this.winner_wrapper.classList.toggle("show-tooltip"),this.winner_wrapper.classList.contains("show-tooltip")&&(e=setTimeout((()=>{this.winner_wrapper.classList.remove("show-tooltip")}),2e3))}))}initialize(t){this.player=t,this.initialized=!0}gameStarted(t,e,i){return $(this,void 0,void 0,(function*(){yield(0,n.C4)((()=>this.fully_parsed)),t?(this.bet_container.innerText=this.player.has_bet?this.player.bet.toString():"-",this.tricks_container.innerText="-",e&&this.betting()):(this.bet_container.innerText=this.player.bet.toString(),this.tricks_container.innerText=this.player.tricks.toString(),e&&this.playing()),this.setDealer(i)}))}setClientPlayer(){this.classList.add("client-player"),this.client_player=!0,(0,n.C4)((()=>this.fully_parsed)).then((()=>{this.bet_input.addEventListener("keyup",(t=>{t.stopImmediatePropagation(),"Enter"===t.key&&this.sendBetEvent()})),this.bet_button.addEventListener("click",(()=>{this.sendBetEvent()}))}))}sendBetEvent(){var t;const e=null!==(t=parseInt(this.bet_input.value))&&void 0!==t?t:NaN;if(isNaN(e)||e<0||e>this.player.cards.length)return void o._.call(this,{message:`Invalid bet value ${e}; bet must be in the range of [0, ${this.player.cards.length}]`});this.bet_input.disabled=!0,this.bet_button.disabled=!0;const i=(0,s.tn)(`player-${this.player.player.player_id}`,"game-update",`{"amount":${this.bet_input.value}}`,"bet");this.dispatchEvent(new CustomEvent("game_update",{detail:i,bubbles:!0}))}newRound(t){this.endRound(),this.setDealer(t)}setDealer(t){this.dealer_wrapper.classList.toggle("show",t),t&&(this.status_container.innerText="Dealer")}endRound(){this.player.bet=-1,this.player.tricks=0,this.bet_container.innerText="-",this.tricks_container.innerText="-",this.dealer_wrapper.classList.remove("show"),this.status_container.innerText=""}betting(){this.classList.add("turn"),this.client_player&&(x.play("turn_notification"),this.bet_input.disabled=!1,this.bet_button.disabled=!1,this.bet_input.value=n.Rk?"0":"",this.bet_input.max=this.player.cards.length.toString(),this.bet_input_wrapper.classList.add("show"))}setBetAnimation(t){return $(this,void 0,void 0,(function*(){this.bet_animation.innerText=t.toString(),this.bet_animation.style.transitionDuration="500ms",this.bet_animation.classList.add("transition"),yield(0,n.J7)(1e3),this.bet_animation.classList.remove("transition"),yield(0,n.J7)(500),this.setBet(t)}))}setBet(t){this.player.bet=t,this.bet_container.innerText=t.toString(),this.classList.remove("turn"),this.client_player&&this.bet_input_wrapper.classList.remove("show")}endBetting(){this.tricks_container.innerText="0"}playing(){this.classList.add("turn"),this.client_player&&x.play("turn_notification")}playCard(){this.classList.remove("turn")}endTrick(t){this.player.tricks=t,this.tricks_container.innerText=t.toString()}setScore(t){this.player.score=t,this.score_container.innerText=t.toString()}wonGame(){this.winner_wrapper.classList.add("show")}}customElements.define("dwg-fiddlesticks-player",D),i(8754),i(7454);var B=function(t,e,i,a){return new(i||(i=Promise))((function(r,s){function n(t){try{o(a.next(t))}catch(t){s(t)}}function d(t){try{o(a.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,d)}o((a=a.apply(t,e||[])).next())}))};class R extends a.r{constructor(){super(),this.current_trick=0,this.player_els=[],this.player_id=-1,this.trick_card_els=[],this.htmlString='<div id="header-messages-container"> <div> <span class="span-align">Round: </span> <span id="round-number"></span> </div> <div> <span class="span-align">Bets: </span> <span id="bets-number"></span> </div> <div> <span class="span-align">Trick: </span> <span id="trick-number"></span> </div> <div id="status-div"> <span class="span-center">Status</span> <span id="status-container"></span> </div> </div> <div id="trump-card-container"> <div id="trump-text">Trump</div> <div id="trump-card"><img id="trump-card-img" alt="Trump Card"></div> </div> <div id="table-container"> <div id="trick-cards"></div> </div> <div id="player-container"></div> <dwg-card-hand id="players-cards"></dwg-card-hand> ',this.configureElement("round_number"),this.configureElement("bets_number"),this.configureElement("trick_number"),this.configureElement("status_container"),this.configureElement("trump_card_img"),this.configureElement("trick_cards"),this.configureElement("table_container"),this.configureElement("player_container"),this.configureElement("players_cards")}parsedCallback(){this.round_number.innerText="-",this.bets_number.innerText="-",this.trick_number.innerText="-",this.status_container.innerText="Starting game ...",this.players_cards.addEventListener("play_card",(t=>{const e=(0,s.tn)(`player-${this.player_id}`,"game-update",`{"index":${t.detail}}`,"play-card");this.dispatchEvent(new CustomEvent("game_update",{detail:e,bubbles:!0}))})),(0,n.Ye)()?this.table_container.style.setProperty("background-image","url(/images/card_table400.png)"):this.table_container.style.setProperty("background-image","url(/images/card_table800.png)")}initialize(t,e){return B(this,void 0,void 0,(function*(){this.player_id=t.playerId(),this.game=e,this.player_els=[];for(const[t,i]of e.players.entries()){const e=document.createElement("dwg-fiddlesticks-player");e.initialize(i),this.player_container.appendChild(e),this.player_els.push(e),this.player_id===t&&e.setClientPlayer()}for(let e=0;e<this.player_els.length;e++){const i=(0,d.zW)(this.player_id+e,this.game.players.length),a=t.isPlayer()?e:e+.5;this.game.players[i].order=a,this.player_els[i].style.setProperty("--order",a.toString()),this.player_els[i].style.setProperty("--num-players",this.player_els.length.toString())}if(this.trick_cards.style.setProperty("--num-players",this.player_els.length.toString()),e.game_base.game_ended);else if(e.game_base.game_started&&e.dealer>=0){this.round_number.innerText=e.round.toString(),this.updateBetsContainer();for(const[t,i]of this.player_els.entries()){const a=t===e.turn,r=t===e.dealer;i.gameStarted(e.betting,a,r),this.player_id!=t||e.game_base.game_ended||(this.players_cards.setCards(e.players[t].cards,e.players[t].cards_played),e.betting||this.game.turn!==this.player_id||(this.players_cards.can_play=!0))}if(e.betting)this.current_trick=0,this.trick_number.innerText="-",this.status_container.innerText=`${e.players[e.turn].player.nickname} Betting`;else{this.current_trick=e.players.reduce(((t,e)=>t+e.tricks),1),this.trick_number.innerText=this.current_trick.toString();for(const[t,i]of e.trick.entries()){let a=e.trick_leader+t;a>=e.players.length&&(a-=e.players.length),this.addPlayedCard({card:i,index:t,player_id:a})}this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Playing`}this.setTrumpImage(e.trump)}}))}updateBetsContainer(){let t=0,e=this.game.dealer+1;for(;e>=this.game.players.length&&(e-=this.game.players.length),!(this.game.betting&&e===this.game.turn||(t+=this.game.players[e].bet,e===this.game.dealer));)e++;this.bets_number.innerText=t.toString()}setTrumpImage(t){this.trump_card_img.src=(0,r.dh)(t),this.trump_card_img.classList.add("show")}gameUpdate(t){return B(this,void 0,void 0,(function*(){try{switch(t.kind){case"deal-round":const e=t.content;yield this.applyDealRound(e);break;case"bet":const i=t.content;if(this.game.turn!==i.player_id)throw new Error("Player bet out of order");yield this.applyBet(i);break;case"play-card":const a=t.content;if(this.game.turn!==a.player_id)throw new Error("Player played out of order");yield this.applyPlayCard(a);break;default:console.log(`Unknown game update type ${t.kind}`)}}catch(e){console.log(`Error during game update ${JSON.stringify(t)}: ${e}`)}}))}applyDealRound(t){return B(this,void 0,void 0,(function*(){const e=t.cards?Math.min(150*t.cards.length,4e3)+250:0;this.game.betting=!0,this.game.dealer=t.dealer,this.game.round=t.round,this.status_container.innerText=`${this.game.players[this.game.dealer].player.nickname} Dealing`,this.round_number.innerText=t.round.toString(),this.bets_number.innerText="0",this.setTrumpImage(t.trump),this.game.trump=t.trump;for(const[i,a]of this.player_els.entries())if(t.dealer===i?a.newRound(!0):a.newRound(!1),i===this.player_id){const i=Math.min(150,e/t.cards.length);this.players_cards.setCards(t.cards,[],i)}yield(0,n.J7)(e),this.trick_number.innerText="-",this.current_trick=0,this.game.round===this.game.max_round&&(this.game.rounds_increasing=!1),this.game.turn=(this.game.dealer+1)%this.game.players.length,this.game.trick_leader=this.game.turn;for(const[e,i]of this.game.players.entries())i.bet=-1,e===this.player_id?i.cards=t.cards:i.cards=[],i.tricks=0;this.player_els[this.game.turn].betting(),this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Betting`}))}applyBet(t){return B(this,void 0,void 0,(function*(){if(this.game.players[t.player_id].bet=t.amount,yield this.player_els[t.player_id].setBetAnimation(t.amount),this.game.betting=this.game.turn!==this.game.dealer,this.status_container.innerText="",this.game.turn=(this.game.turn+1)%this.game.players.length,this.updateBetsContainer(),this.game.betting)this.player_els[this.game.turn].betting(),this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Betting`;else{this.game.trick_leader=this.game.turn,this.trick_number.innerText="1",this.current_trick=1,this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Playing`;for(const[t,e]of this.player_els.entries())e.endBetting(),t===this.game.turn&&(e.playing(),t===this.player_id&&(this.players_cards.can_play=!0))}}))}applyPlayCard(t){return B(this,void 0,void 0,(function*(){if(this.player_id===t.player_id&&this.game.players[t.player_id].cards.splice(t.index,1),this.game.trick.push(t.card),this.player_els[t.player_id].playCard(),t.player_id===this.player_id&&(this.players_cards.playCard(t.index),this.players_cards.can_play=!1),yield this.addPlayedCard(t),yield(0,n.J7)(1e3),this.status_container.innerText="",this.game.turn=(this.game.turn+1)%this.game.players.length,this.game.turn!==this.game.trick_leader)return this.player_els[this.game.turn].playing(),this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Playing`,void(this.game.turn===this.player_id&&(this.players_cards.can_play=!0));yield(0,n.J7)(500);let e=0,i=this.game.trick[0];for(let t=1;t<this.game.trick.length;t++){const a=this.game.trick[t];a.suit===i.suit?a.number>i.number&&(e=t,i=a):a.suit===this.game.trump.suit&&(e=t,i=a)}e>=0&&e<this.trick_card_els.length&&(this.trick_card_els[e].style.zIndex="2"),this.game.turn=(this.game.trick_leader+e)%this.game.players.length,this.game.trick_leader=this.game.turn;for(const t of this.trick_card_els)t.classList.remove("played"),t.classList.add("center");yield(0,n.J7)(1e3),this.trick_cards.style.setProperty("--winner",this.game.players[this.game.turn].order.toString());for(const t of this.trick_card_els)t.classList.remove("center"),t.classList.add("winner");yield(0,n.J7)(1e3),this.game.players[this.game.turn].tricks++;for(const[t,e]of this.player_els.entries())e.endTrick(this.game.players[t].tricks);if(this.trick_cards.replaceChildren(),this.trick_card_els=[],this.game.trick=[],this.trick_number.innerText="-",console.log(`Trick won by ${this.game.players[this.game.turn].player.nickname} with the ${(0,r._F)(i)}`),this.current_trick!==this.game.round)return this.current_trick++,this.trick_number.innerText=this.current_trick.toString(),this.player_els[this.game.turn].playing(),this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Playing`,void(this.game.turn===this.player_id&&(this.players_cards.can_play=!0));yield(0,n.J7)(500),console.log("Round over"),this.bets_number.innerText="-",this.trump_card_img.classList.remove("show");for(const[t,e]of this.game.players.entries())e.bet===e.tricks&&(e.score+=this.game.round_points+this.game.trick_points*e.bet,this.player_els[t].setScore(e.score)),this.player_els[t].endRound();if(this.round_number.innerText="-",this.game.rounds_increasing&&this.game.round===this.game.max_round&&(this.game.rounds_increasing=!1),this.game.rounds_increasing||this.game.round!==this.game.min_round)this.game.rounds_increasing?this.game.round++:this.game.round--;else{console.log("Game over"),this.game.game_base.game_ended=!0;let t=[0],e=this.game.players[0].score;for(let i=1;i<this.game.players.length;i++){const a=this.game.players[i];a.score>e?(t=[i],e=a.score):a.score===e&&t.push(i)}for(const e of t)this.player_els[e].wonGame();let i=t.length>1?"The winners are: ":"The winner is: ";i+=t.map((t=>this.game.players[t].player.nickname)).join(", "),i+=`\nWith ${e} points`,o._.call(this,{message:i}),this.status_container.innerText="game over"}}))}addPlayedCard(t){return B(this,void 0,void 0,(function*(){const e=document.createElement("div"),i=document.createElement("img");i.src=(0,r.dh)(t.card),i.draggable=!1,i.alt=(0,r.zU)(t.card),e.appendChild(i),e.classList.add("card"),e.style.setProperty("--i",this.game.players[t.player_id].order.toString()),this.trick_cards.appendChild(e),this.trick_card_els.push(e),e.style.transitionDuration="1s",yield(0,n.C4)((()=>!!getComputedStyle(e).left),20),e.classList.add("played")}))}updateDialogComponent(t){const e=document.createElement("div"),i=[];switch(t.kind){case"deal-round":const e=t.content,a=this.game.players[e.dealer].player.nickname;if(i.push(`Round ${e.round} dealt by ${a}`),i.push(`Card flipped over as trump was ${(0,r.zU)(e.trump)}`),e.cards){const t=e.cards.map((t=>(0,r.zU)(t))).join(", ");i.push(`Cards dealt to you: ${t}`)}break;case"bet":const s=t.content,n=this.game.players[s.player_id].player.nickname;i.push(`${n} bet ${s.amount} points`);break;case"play-card":const d=t.content,o=this.game.players[d.player_id].player.nickname;i.push(`${o} played ${(0,r.zU)(d.card)}`);break;default:i.push(`Unknown update type for fiddlesticks: ${t.kind}`)}if(1===i.length)e.innerHTML=i[0];else for(const t of i){const i=document.createElement("div");i.innerHTML=t,e.appendChild(i)}return e}}customElements.define("dwg-fiddlesticks",R)},7454:(t,e,i)=>{var a=i(4268),r=i(5450),s=i(7483);class n{constructor(t){this.keynames=[],this.maps=new Map,this._size=0,this.keynames=t;for(const e of t)this.maps.set(e,new Map)}get(t,e){var i;return null===(i=this.maps.get(t))||void 0===i?void 0:i.get(e)}set(t,e){if(t.length!==this.keynames.length||0===t.length)return!1;for(const[i,a]of this.keynames.entries())this.maps.get(a).set(t[i],e);return this._size=this.maps.get(this.keynames[0]).size,!0}delete(t){if(t.length!==this.keynames.length||0===t.length)return!1;let e=!0;for(const[i,a]of this.keynames.entries())this.maps.get(a).delete(t[i])||(e=!1);return this._size=this.maps.get(this.keynames[0]).size,e}clear(){for(const[t,e]of this.keynames.entries())this.maps.get(e).clear();this._size=0}size(){return this._size}keys(t){var e;return this.maps.has(t)?[].values():null===(e=this.maps.get(t))||void 0===e?void 0:e.keys()}values(){return 0===this._size?[].values():this.maps.get(this.keynames[0]).values()}}var d=i(3379),o=i.n(d),c=i(7795),l=i.n(c),h=i(569),g=i.n(h),p=i(3565),m=i.n(p),u=i(9216),v=i.n(u),y=i(4589),_=i.n(y),f=i(3697),w={};w.styleTagTransform=_(),w.setAttributes=m(),w.insert=g().bind(null,"head"),w.domAPI=l(),w.insertStyleElement=v(),o()(f.Z,w),f.Z&&f.Z.locals&&f.Z.locals;var b=function(t,e,i,a){return new(i||(i=Promise))((function(r,s){function n(t){try{o(a.next(t))}catch(t){s(t)}}function d(t){try{o(a.throw(t))}catch(t){s(t)}}function o(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(n,d)}o((a=a.apply(t,e||[])).next())}))};class k extends a.r{constructor(){super(),this.can_play=!1,this.cards=new n(["i","i_dom"]),this.dragging_data={dragging:!1,index:-1,touch_identifier:-1,start:{x:0,y:0},start_rect:new DOMRect(0,0,0,0),hovering_play_drop:!1},this.dragging_lock=(0,s.YH)(),this.classList.add("hidden"),this.htmlString='<div id="cards-container"></div> <div id="play-drop"></div> <div id="cancel-drop"></div>',this.configureElement("cards_container"),this.configureElement("play_drop"),this.configureElement("cancel_drop")}parsedCallback(){return b(this,void 0,void 0,(function*(){yield(0,s.C4)((()=>!!this.clientHeight)),this.resizeCallback(),this.setEventListeners(),this.classList.remove("hidden")}))}resizeCallback(){const t=this.getBoundingClientRect();this.style.setProperty("--height",`${t.height.toString()}px`),this.style.setProperty("--width",`${t.width.toString()}px`);const e=.4*t.height;this.style.setProperty("--play-drop-margin",`${e.toString()}px`)}setEventListeners(){document.body.addEventListener("mouseup",(t=>{if(0!==t.button)return;if(!this.dragging_data.dragging)return;const e=this.cards.get("i",this.dragging_data.index);e?(t.stopImmediatePropagation(),e.el.classList.remove("hovering"),this.stopDraggingCard(e)):this.stopDragging()})),document.body.addEventListener("touchend",(t=>{if(t.stopImmediatePropagation(),!this.dragging_data.dragging)return;const e=this.cards.get("i",this.dragging_data.index);e?0!==t.touches.length?t.touches[0].identifier===this.dragging_data.touch_identifier&&this.stopDraggingCard(e):this.stopDraggingCard(e):this.stopDragging()})),document.body.addEventListener("mousemove",(t=>{if(!this.dragging_data.dragging)return;const e=this.cards.get("i",this.dragging_data.index);e?(t.stopImmediatePropagation(),this.dragCard(t,e)):this.stopDragging()})),document.documentElement.addEventListener("mouseenter",(t=>{if(!this.dragging_data.dragging||t.buttons%2==1)return;const e=this.cards.get("i",this.dragging_data.index);e?this.stopDraggingCard(e,!0):this.stopDragging()})),document.body.addEventListener("touchmove",(t=>{if(t.stopImmediatePropagation(),!this.dragging_data.dragging)return;const e=this.cards.get("i",this.dragging_data.index);if(!e)return void this.stopDragging();if(0===t.touches.length)return;const i=t.touches[0];i.identifier===this.dragging_data.touch_identifier&&this.dragCard({x:i.clientX,y:i.clientY},e)}))}setCards(t,e=[],i=0){this.cards_container.replaceChildren();const a=t.map(((t,e)=>({i:e,card:t}))).sort(((t,e)=>(0,r.fr)(t.card,e.card)));let s=0;for(const[t,r]of a.entries())e.some((t=>t===r.i))?s++:(r.i_dom=t-s,this.createCardEl(r,i))}createCardEl(t,e=0){const i=document.createElement("div"),a=document.createElement("img");a.src=(0,r.dh)(t.card),a.draggable=!1,a.alt=(0,r.zU)(t.card),i.appendChild(a),i.classList.add("card"),i.style.setProperty("--i",t.i_dom.toString()),t.el=i,setTimeout((()=>{this.cards.set([t.i,t.i_dom],t),this.cards_container.style.setProperty("--num-cards",this.cards.size().toString()),this.cards_container.appendChild(i),i.addEventListener("dblclick",(()=>{this.can_play&&this.dispatchEvent(new CustomEvent("play_card",{detail:t.i}))})),i.addEventListener("mousedown",(e=>{0===e.button&&(e.stopImmediatePropagation(),this.startDraggingCard({x:e.x,y:e.y},t))})),i.addEventListener("mouseenter",(t=>{t.stopImmediatePropagation(),this.dragging_data.dragging||i.classList.add("hovering")})),i.addEventListener("mouseleave",(t=>{t.stopImmediatePropagation(),i.classList.remove("hovering")})),i.addEventListener("touchstart",(e=>{if(e.stopImmediatePropagation(),0===e.touches.length)return;const i=e.touches[0];this.startDraggingCard({x:i.clientX,y:i.clientY},t,i.identifier)}))}),(1+t.i_dom)*e)}startDraggingCard(t,e,i=0){this.dragging_lock((()=>b(this,void 0,void 0,(function*(){if(this.dragging_data.dragging){const t=this.cards.get("i",this.dragging_data.index);t&&this.stopDraggingCard(t)}this.dragging_data.dragging=!0,this.dragging_data.index=e.i,this.dragging_data.touch_identifier=i,this.dragging_data.start=t,this.dragging_data.start_rect=e.el.getBoundingClientRect(),e.el.style.setProperty("--x","0px"),e.el.style.setProperty("--y","0px"),this.play_drop.classList.remove("hovering"),this.cancel_drop.classList.add("hovering"),this.dragging_data.hovering_play_drop=!1,e.el.classList.add("dragging"),this.classList.add("dragging"),this.can_play&&this.classList.add("dragging-playing")}))))}dragCard(t,e){this.dragging_lock((()=>b(this,void 0,void 0,(function*(){var i,a,r;if(!this.dragging_data.dragging)return;const s=e.el.getBoundingClientRect();if(t.x<this.dragging_data.start.x&&e.i_dom>0){const t=this.cards.get("i_dom",e.i_dom-1),a=null===(i=null==t?void 0:t.el)||void 0===i?void 0:i.getBoundingClientRect();if(t&&s.x<(null==a?void 0:a.x)){const i=this.dragging_data.start_rect.x-a.x;this.dragging_data.start_rect.x-=i,this.dragging_data.start.x-=i,e.i_dom--,t.i_dom++,e.el.style.setProperty("--i",e.i_dom.toString()),t.el.style.setProperty("--i",t.i_dom.toString()),this.cards.set([e.i,e.i_dom],e),this.cards.set([t.i,t.i_dom],t)}}else if(t.x>this.dragging_data.start.x&&e.i_dom<this.cards.size()-1){const t=this.cards.get("i_dom",e.i_dom+1),i=null===(a=null==t?void 0:t.el)||void 0===a?void 0:a.getBoundingClientRect();if(t&&s.x>(null==i?void 0:i.x)){const a=i.x-this.dragging_data.start_rect.x;this.dragging_data.start_rect.x+=a,this.dragging_data.start.x+=a,e.i_dom++,t.i_dom--,e.el.style.setProperty("--i",e.i_dom.toString()),t.el.style.setProperty("--i",t.i_dom.toString()),this.cards.set([e.i,e.i_dom],e),this.cards.set([t.i,t.i_dom],t)}}e.el.style.setProperty("--x",`${(t.x-this.dragging_data.start.x).toString()}px`),e.el.style.setProperty("--y",`${(t.y-this.dragging_data.start.y).toString()}px`),t.y<(null===(r=this.cancel_drop.getBoundingClientRect())||void 0===r?void 0:r.top)?(this.play_drop.classList.add("hovering"),this.cancel_drop.classList.remove("hovering"),this.dragging_data.hovering_play_drop=!0):(this.play_drop.classList.remove("hovering"),this.cancel_drop.classList.add("hovering"),this.dragging_data.hovering_play_drop=!1)}))))}stopDragging(){this.dragging_data.dragging=!1,this.classList.remove("dragging"),this.classList.remove("dragging-playing")}stopDraggingCard(t,e=!1){this.dragging_lock((()=>b(this,void 0,void 0,(function*(){this.stopDragging(),t.el.classList.remove("dragging"),!e&&this.can_play&&this.dragging_data.hovering_play_drop&&this.dispatchEvent(new CustomEvent("play_card",{detail:t.i}))}))))}playCard(t){const e=this.cards.get("i",t);e?(e.el.remove(),this.cards.delete([t,e.i_dom]),this.dragging_lock((()=>b(this,void 0,void 0,(function*(){this.cards_container.style.setProperty("--num-cards",this.cards.size().toString());for(const t of this.cards.values())t.i_dom<=e.i_dom||(t.i_dom--,t.el.style.setProperty("--i",t.i_dom.toString()))}))))):console.error("Trying to play card that does not exist")}substituteCard(t,e){const i=this.cards.get("i",t);i?(i.el.remove(),i.el=void 0,i.card=e,this.createCardEl(i)):console.error("Trying to substitute card that does not exist")}removeCards(){this.cards.clear(),this.cards_container.replaceChildren(),this.can_play=!1}}customElements.define("dwg-card-hand",k)},5450:(t,e,i)=>{i.d(e,{Mi:()=>s,W2:()=>n,_F:()=>l,dh:()=>g,fr:()=>r,zU:()=>h});var a=i(7483);function r(t,e){return t.suit!==e.suit?t.suit-e.suit:t.number-e.number}function s(t){switch(t){case 1:case 3:return"Red";case 2:case 4:return"Black";default:return"error"}}function n(t){switch(t){case 1:return"Heart";case 2:return"Club";case 3:return"Diamond";case 4:return"Spade";default:return"error"}}function d(t){switch(t){case 1:return"♥";case 2:return"♣";case 3:return"♦";case 4:return"♠";default:return"✪"}}function o(t){if(t>1&&t<11)return t.toString();switch(t){case 11:return"Jack";case 12:return"Queen";case 13:return"King";case 14:return"Ace";default:return"error"}}function c(t){if(t>1&&t<11)return t.toString();switch(t){case 11:return"J";case 12:return"Q";case 13:return"K";case 14:return"A";default:return"?"}}function l(t){return`${o(t.number)} of ${n(t.suit)}s`}function h(t,e=!0){return e?(0,a.wO)(`\n    <span style="margin-right: 0.9em">\n      ${c(t.number)}\n      <span style="color:${function(t){switch(t){case 1:case 3:return"rgb(223, 0, 0)";case 2:case 4:return"rgb(0, 0, 0)";default:return"error"}}(t.suit)}; font-size: 1.3em; margin-left: 0.05em; margin-top: -0.15em; position: absolute;">\n        ${d(t.suit)}\n      </span>\n    </span>`):`${c(t.number)}${d(t.suit)}`}function g(t){let e=`${o(t.number).toLowerCase()}_of_${n(t.suit).toLowerCase()}s`;return t.number>10&&t.number<14&&(e+="2"),`/images/cards/${e}.png`}},6442:(t,e,i)=>{function a(t,e){return(t%e+e)%e}function r(t,e){const i=Math.atan2(t,e);return 0===i?0:i<0?-i:2*Math.PI-i}function s(t,e,i,a=!0){return isNaN(e)||null==e||isNaN(i)||null==i?t:i<e?s(t,i,e):isNaN(t)||null==t?a?e:i:t>i?i:t<e?e:t}i.d(e,{IV:()=>s,fd:()=>r,zW:()=>a})},6619:(t,e,i)=>{t.exports=i.p+"118e673d7c1547e848c0.png"},721:(t,e,i)=>{t.exports=i.p+"e929e15745a5bc384268.png"}},t=>{t(t.s=3704)}]);