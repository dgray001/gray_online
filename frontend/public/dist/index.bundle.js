(()=>{"use strict";var t={59:(t,e,n)=>{n.d(e,{Z:()=>s});var o=n(81),i=n.n(o),r=n(645),a=n.n(r)()(i());a.push([t.id,"dwg-chatbox{--input-box-height: 35px;background-color:#c8c8c8;color:#000;display:block;height:100%;width:100%}dwg-chatbox #chat-container{display:flex;flex-flow:column nowrap;height:calc(100% - var(--input-box-height));width:100%}dwg-chatbox #chat-container :first-child{margin-top:auto}dwg-chatbox #chat-container>.color-gray{color:#646464}dwg-chatbox #input-container{--margin: 8px;--send-button-width: 70px;display:flex;flex-flow:row nowrap;height:var(--input-box-height);width:100%}dwg-chatbox #input-container>*{box-sizing:border-box;height:calc(100% - var(--margin));margin-top:var(--margin)}dwg-chatbox #input-container #chat-input{width:calc(100% - var(--send-button-width))}dwg-chatbox #input-container #send-chat{width:var(--send-button-width)}",""]);const s=a},630:(t,e,n)=>{n.d(e,{Z:()=>s});var o=n(81),i=n.n(o),r=n(645),a=n.n(r)()(i());a.push([t.id,".dwg-element:not(.parsed){display:none}",""]);const s=a},732:(t,e,n)=>{n.d(e,{Z:()=>s});var o=n(81),i=n.n(o),r=n(645),a=n.n(r)()(i());a.push([t.id,"dwg-lobby{--name-header-height: 30px;--buttons-height: 50px;--chat-height: 200px;background-color:#143c78;display:flex;flex-flow:column nowrap}dwg-lobby #name-header{background-color:#001e3c;box-sizing:border-box;display:block;font-size:18px;height:var(--name-header-height);line-height:var(--name-header-height);max-height:var(--name-header-height);min-height:var(--name-header-height);padding-left:1.5em;width:100%}dwg-lobby #buttons{background-color:#0a3264;border-bottom:2px solid #000;box-sizing:border-box;display:flex;flex-flow:row nowrap;gap:8px;height:var(--buttons-height);max-height:var(--buttons-height);min-height:var(--buttons-height);width:100%}dwg-lobby #buttons>button{background-color:rgba(0,0,0,0);border:none;border-radius:16px;color:#fff;font-size:20px;padding:8px;transition:background-color 200ms,border-radius 200ms}dwg-lobby #buttons>button:hover:not(:disabled){background-color:rgba(50,100,200,.2)}dwg-lobby #buttons>button:active:not(:disabled){background-color:rgba(70,140,250,.4);border-radius:0px}dwg-lobby #buttons>button:disabled{background-color:rgba(150,150,150,.6);border-radius:8px;transition:none}dwg-lobby #horizontal-container{display:flex;flex-flow:row nowrap;flex:1 0 0;width:100%}dwg-lobby #horizontal-container #vertical-container{display:flex;flex-flow:column nowrap;flex:1 0 0;height:100%}dwg-lobby #horizontal-container #vertical-container #room-container{box-sizing:border-box;flex:1 0 0;padding:12px}dwg-lobby #horizontal-container #vertical-container #chatbox{box-sizing:border-box;height:var(--chat-height);max-height:var(--chat-height);min-height:var(--chat-height);padding:12px}dwg-lobby #horizontal-container #lobby-users{background-color:#0a1e32;box-sizing:border-box;height:100%;padding:8px;width:250px}",""]);const s=a},11:(t,e,n)=>{n.d(e,{Z:()=>s});var o=n(81),i=n.n(o),r=n(645),a=n.n(r)()(i());a.push([t.id,"dwg-lobby-connector{background-color:rgba(120,120,120,.8);height:100%;left:0px;position:absolute;top:0px;width:100%;z-index:2}dwg-lobby-connector.hide{display:none}dwg-lobby-connector #card{background-color:#dcdcdc;color:#000;height:200px;left:calc(50% - 100px);padding:16px;position:relative;top:calc(50% - 150px);width:300px}dwg-lobby-connector #card #nickname{font-size:24px;margin-top:20px;width:290px}dwg-lobby-connector #card #connect-button{font-size:24px;margin-top:50px;width:290px}",""]);const s=a},381:(t,e,n)=>{n.d(e,{Z:()=>s});var o=n(81),i=n.n(o),r=n(645),a=n.n(r)()(i());a.push([t.id,"dwg-lobby-room-selector{display:block}",""]);const s=a},391:(t,e,n)=>{n.d(e,{Z:()=>s});var o=n(81),i=n.n(o),r=n(645),a=n.n(r)()(i());a.push([t.id,"",""]);const s=a},706:(t,e,n)=>{n.d(e,{Z:()=>s});var o=n(81),i=n.n(o),r=n(645),a=n.n(r)()(i());a.push([t.id,"dwg-page-home{--margin-size: 16px;--height: calc(100vh - 2 * var(--margin-size));--width: calc(100% - 2 * var(--margin-size));background-color:#05285a;display:block;height:var(--height);max-height:var(--height);max-width:var(--width);min-height:var(--height);min-width:var(--width);padding:var(--margin-size);width:var(--width)}dwg-page-home #lobby{height:100%;width:100%}",""]);const s=a},197:(t,e,n)=>{n.d(e,{Z:()=>s});var o=n(81),i=n.n(o),r=n(645),a=n.n(r)()(i());a.push([t.id,"",""]);const s=a},99:(t,e,n)=>{n.d(e,{Z:()=>s});var o=n(81),i=n.n(o),r=n(645),a=n.n(r)()(i());a.push([t.id,'body{background-color:#000;color:#fff;font-family:"Fira Sans",sans-serif;margin:0;min-height:100vh;min-width:100%;padding:0}',""]);const s=a},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",o=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),o&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),o&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,o,i,r){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(o)for(var s=0;s<this.length;s++){var c=this[s][0];null!=c&&(a[c]=!0)}for(var d=0;d<t.length;d++){var l=[].concat(t[d]);o&&a[l[0]]||(void 0!==r&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=r),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),e.push(l))}},e}},81:t=>{t.exports=function(t){return t[1]}},91:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),e.hash&&(t+=e.hash),e.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(t)?'"'.concat(t,'"'):t):t}},379:t=>{var e=[];function n(t){for(var n=-1,o=0;o<e.length;o++)if(e[o].identifier===t){n=o;break}return n}function o(t,o){for(var r={},a=[],s=0;s<t.length;s++){var c=t[s],d=o.base?c[0]+o.base:c[0],l=r[d]||0,h="".concat(d," ").concat(l);r[d]=l+1;var u=n(h),b={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==u)e[u].references++,e[u].updater(b);else{var m=i(b,o);o.byIndex=s,e.splice(s,0,{identifier:h,updater:m,references:1})}a.push(h)}return a}function i(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var r=o(t=t||[],i=i||{});return function(t){t=t||[];for(var a=0;a<r.length;a++){var s=n(r[a]);e[s].references--}for(var c=o(t,i),d=0;d<r.length;d++){var l=n(r[d]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}r=c}}},569:t=>{var e={};t.exports=function(t,n){var o=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(o,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},798:(t,e,n)=>{t.exports=n.p+"c228add931e314b642c5.png"}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={id:o,exports:{}};return t[o](r,r.exports,n),r.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.p="dist/",n.b=document.baseURI||self.location.href,n.nc=void 0,(()=>{var t=n(379),e=n.n(t),o=n(795),i=n.n(o),r=n(569),a=n.n(r),s=n(565),c=n.n(s),d=n(216),l=n.n(d),h=n(589),u=n.n(h),b=n(99),m={};m.styleTagTransform=u(),m.setAttributes=c(),m.insert=a().bind(null,"head"),m.domAPI=i(),m.insertStyleElement=l(),e()(b.Z,m),b.Z&&b.Z.locals&&b.Z.locals;var g=n(197),p={};function f(t,e,n={}){const o=Object.assign({loading_text:void 0,disable_button:!0,re_enable_button:!0},n);t.addEventListener("click",(()=>{o.disable_button&&(t.disabled=!0);const n=t.innerText;function i(e,o){t.innerText="string"==typeof e?e:n,o&&(t.disabled=!1)}i(o.loading_text);const r=e();r instanceof Promise?r.then((t=>{i(t,o.re_enable_button)})):i(r,o.re_enable_button)}))}p.styleTagTransform=u(),p.setAttributes=c(),p.insert=a().bind(null,"head"),p.domAPI=i(),p.insertStyleElement=l(),e()(g.Z,p),g.Z&&g.Z.locals&&g.Z.locals;var y=n(630),v={};v.styleTagTransform=u(),v.setAttributes=c(),v.insert=a().bind(null,"head"),v.domAPI=i(),v.insertStyleElement=l(),e()(y.Z,v),y.Z&&y.Z.locals&&y.Z.locals;class x extends HTMLElement{constructor(){super(...arguments),this.fully_parsed=!1,this.elsMetadata=[]}connectedCallback(){return t=this,e=void 0,o=function*(){this.classList.add("dwg-element"),this.innerHTML=this.htmlString,yield function(t,e=300){const n=o=>{t()?o():setTimeout((()=>n(o)),e)};return new Promise(n)}(this.elementsParsed.bind(this)),this.parsedCallback(),this.classList.add("parsed"),this.fully_parsed=!0},new((n=void 0)||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}));var t,e,n,o}elementsParsed(){let t=!0;for(const e of this.elsMetadata){let n=e.found_element?this[e.name]:null;e.found_element||(n=this.querySelector(`#${e.element_id}`),n&&(this[e.name]=n,e.found_element=!0)),e.found_element?n instanceof x&&(n.fully_parsed||(t=!1)):t=!1}return t}parsedCallback(){}configureElement(t,e){e||(e=t.replace(/_/g,"-")),this.elsMetadata.push({element_id:e,name:t})}}function w(t,e){return n=this,o=void 0,r=function*(){const n=e instanceof File,o=n?e.type:"application/json",i=n?e.name:void 0,r=n?e:JSON.stringify(e);try{const e=yield fetch(function(t){return`/api/${t}/`}(t),{method:"POST",headers:{"Content-Type":o,"X-File-Name":i},body:r});return yield e.json()}catch(t){console.log(t)}return{success:!1,error_message:"Server error; please report this bug."}},new((i=void 0)||(i=Promise))((function(t,e){function a(t){try{c(r.next(t))}catch(t){e(t)}}function s(t){try{c(r.throw(t))}catch(t){e(t)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(a,s)}c((r=r.apply(n,o||[])).next())}));var n,o,i,r}var _=n(381),k={};function E(t){return`<dwg-lobby-room-selector room-name="${t.room_name}"></dwg-lobby-room-selector>`}k.styleTagTransform=u(),k.setAttributes=c(),k.insert=a().bind(null,"head"),k.domAPI=i(),k.insertStyleElement=l(),e()(_.Z,k),_.Z&&_.Z.locals&&_.Z.locals,customElements.define("dwg-lobby-room-selector",class extends x{constructor(){super(),this.htmlString='<span id="room-name">Hello from lobby-room-selector!</span> ',this.configureElement("room_name")}parsedCallback(){var t,e;this.room_name.innerHTML=null!==(e=null===(t=this.attributes.getNamedItem("room-name"))||void 0===t?void 0:t.value)&&void 0!==e?e:"- unknown -"}});var Z=n(732),C={};C.styleTagTransform=u(),C.setAttributes=c(),C.insert=a().bind(null,"head"),C.domAPI=i(),C.insertStyleElement=l(),e()(Z.Z,C),Z.Z&&Z.Z.locals&&Z.Z.locals;var T=n(59),S={};S.styleTagTransform=u(),S.setAttributes=c(),S.insert=a().bind(null,"head"),S.domAPI=i(),S.insertStyleElement=l(),e()(T.Z,S),T.Z&&T.Z.locals&&T.Z.locals,customElements.define("dwg-chatbox",class extends x{constructor(){super(),this.htmlString='<div id="chat-container"></div> <div id="input-container"> <input id="chat-input" placeholder="Chat with the entire lobby"> <button id="send-chat">Send</button> </div>',this.configureElement("chat_container"),this.configureElement("chat_input"),this.configureElement("send_chat")}parsedCallback(){f(this.send_chat,(()=>{this.sendChat()})),this.chat_input.addEventListener("keyup",(t=>{"Enter"===t.key&&this.sendChat()}))}addChat(t){const e="server"===t.sender||"gray"===t.color?'<div class="color-gray">':"<div>",n=t.sender&&"server"!==t.sender?`${t.sender}: `:"";this.chat_container.innerHTML+=`${e}${n}${t.message}</div>`}sendChat(){if(this.inputEmpty())return;const t=new CustomEvent("chat_sent",{detail:this.getInput()});this.dispatchEvent(t)}inputEmpty(){return!this.chat_input.value}getInput(){const t={message:this.chat_input.value};return this.chat_input.value="",t}});var L=n(91),A=n.n(L),M=new URL(n(798),n.b);const I='<div id="header"> <button id="refresh-button"><img src="'+A()(M)+'" alt="refresh"></button> </div> <div id="user-container"></div>';var P=n(391),z={};z.styleTagTransform=u(),z.setAttributes=c(),z.insert=a().bind(null,"head"),z.domAPI=i(),z.insertStyleElement=l(),e()(P.Z,z),P.Z&&P.Z.locals&&P.Z.locals,customElements.define("dwg-lobby-users",class extends x{constructor(){super(),this.htmlString=I,this.configureElement("example")}parsedCallback(){console.log("DwgLobbyUsers parsed!")}});var $=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function a(t){try{c(o.next(t))}catch(t){r(t)}}function s(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((o=o.apply(t,e||[])).next())}))};customElements.define("dwg-lobby",class extends x{constructor(){super(),this.connection_metadata={nickname:"Anonymous"},this.connection_lost=new Event("connection_lost"),this.htmlString='<span id="name-header"></span> <span id="buttons"> <button id="refresh-lobby-button">Refresh</button> <button id="create-room-button">Create Room</button> </span> <span id="horizontal-container"> <span id="vertical-container"> <div id="room-container"></div> <dwg-chatbox id="chatbox"></dwg-chatbox> </span> <dwg-lobby-users id="lobby-users"></dwg-lobby-users> </span>',this.configureElement("name_header"),this.configureElement("refresh_lobby_button"),this.configureElement("create_room_button"),this.configureElement("room_container"),this.configureElement("chatbox")}parsedCallback(){f(this.refresh_lobby_button,(()=>$(this,void 0,void 0,(function*(){yield this.refreshLobby()})))),f(this.create_room_button,(()=>$(this,void 0,void 0,(function*(){return yield w(`lobby/rooms/create/${this.connection_metadata.client_id}`,""),"Room Created"}))),{loading_text:"Creating Room ...",re_enable_button:!1}),this.chatbox.addEventListener("chat_sent",(t=>{var e;let n=!1;try{const o=t.detail;this.socketActive()&&(this.socket.send(this.createMessage(null!==(e=o.sender)&&void 0!==e?e:`client-${this.connection_metadata.client_id}`,"lobby-chat",o.message,o.color)),n=!0),n?this.chatbox.addChat(Object.assign(Object.assign({},o),{sender:this.connection_metadata.client_id.toString()})):this.chatbox.addChat({message:`Message unable to be sent: "${o.message}"`,color:"gray"})}catch(t){this.chatbox.addChat({message:"Error trying to send message",color:"gray"})}})),this.refreshLobby()}setSocket(t){this.socket&&this.socket.close(3e3,"opening new connection"),this.socket=t,this.socket.addEventListener("message",(t=>{try{const e=JSON.parse(t.data);this.handleMessage(e)}catch(e){console.log("Error parsing message: ",t,e)}}))}refreshLobby(){return $(this,void 0,void 0,(function*(){this.room_container.innerHTML=" ... loading",yield(500,new Promise((t=>setTimeout(t,500))));const t=yield w("lobby/rooms/get","");if(t.success){let e="";for(const n of t.result)e+=E(n);this.room_container.innerHTML=e}else this.room_container.innerHTML=`Error loading rooms: ${t.error_message}`}))}handleMessage(t){if(this.socketActive())switch(console.log(t),t.kind){case"lobby-you-joined":const e=parseInt(t.data);e?(this.connection_metadata.client_id=e,this.setNickname(t.content),this.chatbox.addChat({message:`You (${this.connection_metadata.nickname}) joined lobby with client id ${e}`,sender:"server"}),this.socket.send(this.createMessage(`client-${e}`,"lobby-join",this.connection_metadata.nickname,`${e}`))):(this.socket.close(3001,"you-joined-lobby message did not return properly formed client id"),this.dispatchEvent(this.connection_lost));break;case"lobby-join":const n=parseInt(t.data);n&&this.chatbox.addChat({message:`${t.content} joined lobby with client id ${n}`,sender:"server"});break;case"lobby-left":const o=parseInt(t.data);o&&this.chatbox.addChat({message:`${t.content} (client id ${o}) left lobby`,sender:"server"});break;case"lobby-chat":const i=parseInt(t.sender.replace("client-",""));i&&this.chatbox.addChat({message:t.content,sender:i.toString()});default:console.log("Unknown message type",t.kind,"from",t.sender)}}socketActive(){return!!this.socket&&this.socket.readyState==WebSocket.OPEN}createMessage(t,e,n,o){return JSON.stringify({sender:t,kind:e,content:n,data:o})}setNickname(t){this.connection_metadata.nickname=t,this.name_header.innerText=t}});var N=n(11),j={};j.styleTagTransform=u(),j.setAttributes=c(),j.insert=a().bind(null,"head"),j.domAPI=i(),j.insertStyleElement=l(),e()(N.Z,j),N.Z&&N.Z.locals&&N.Z.locals,customElements.define("dwg-lobby-connector",class extends x{constructor(){super(),this.submitted=new Event("submitted"),this.htmlString='<div id="card"> <input id="nickname" placeholder="Nickname"> <button id="connect-button">Connect to Lobby</button> <div id="status-message"></div> </div> ',this.configureElement("card"),this.configureElement("nickname"),this.configureElement("connect_button"),this.configureElement("status_message")}parsedCallback(){this.connect_button.disabled=!0,this.nickname.addEventListener("keyup",(t=>{const e=this.validName(this.nickname.value);this.connect_button.disabled=!e,e&&"Enter"===t.key&&this.dispatchEvent(this.submitted)})),f(this.connect_button,(()=>(this.dispatchEvent(this.submitted),"Connecting ...")),{re_enable_button:!1})}validName(t){return!!t.length}});var O=n(706),H={};H.styleTagTransform=u(),H.setAttributes=c(),H.insert=a().bind(null,"head"),H.domAPI=i(),H.insertStyleElement=l(),e()(O.Z,H),O.Z&&O.Z.locals&&O.Z.locals,customElements.define("dwg-page-home",class extends x{constructor(){super(),this.htmlString='<dwg-lobby id="lobby"></dwg-lobby> <dwg-lobby-connector id="lobby-connector"></dwg-lobby-connector>',this.configureElement("lobby"),this.configureElement("lobby_connector")}parsedCallback(){this.lobby_connector.addEventListener("submitted",(()=>{const t=this.lobby_connector.nickname.value,e=new WebSocket(`ws://127.0.0.1:6807/api/lobby/connect/${t}`);e.addEventListener("error",(t=>{console.log(t),this.tryConnectionAgain("Could not connect. Check your connection and try again.")})),e.addEventListener("open",(()=>{this.lobby.setSocket(e),this.lobby.connection_metadata.nickname=t,this.lobby.name_header.innerText=t,this.lobby_connector.classList.add("hide")}))})),this.lobby.addEventListener("connection_lost",(()=>{this.tryConnectionAgain("Connection was lost. Check your connection and try again.")}))}tryConnectionAgain(t){this.lobby_connector.classList.remove("hide"),this.lobby_connector.status_message.innerText=t,this.lobby_connector.connect_button.disabled=!1,this.lobby_connector.connect_button.innerText="Connect to Lobby"}})})()})();