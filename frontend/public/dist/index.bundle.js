(()=>{"use strict";var e={59:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-chatbox{--input-box-height: 35px;background-color:#c8c8c8;color:#000;display:block;height:100%;width:100%}dwg-chatbox #chat-container{display:flex;flex-flow:column nowrap;height:calc(100% - var(--input-box-height));overflow-wrap:anywhere;overflow-y:scroll;width:100%;word-break:break-all}dwg-chatbox #chat-container :first-child{margin-top:auto}dwg-chatbox #chat-container>*{margin-top:.3em;transition:background-color 1s}dwg-chatbox #chat-container>*.new-message{background-color:rgba(255,255,0,.4);transition:none}dwg-chatbox #chat-container>*.color-gray{color:#646464}dwg-chatbox #new-messages-container{height:0;position:relative;width:100%}dwg-chatbox #new-messages-container #new-messages-button{--width: max(130px, 20%);background-color:#6e8cff;bottom:0;border:0px;border-radius:1.6em;height:1.5em;left:calc(50% - .5*var(--width));margin:0;padding:0;position:absolute;width:var(--width)}dwg-chatbox #new-messages-container #new-messages-button:not(.show){display:none}dwg-chatbox #new-messages-container #new-messages-button:hover{background-color:#82a0ff}dwg-chatbox #new-messages-container #new-messages-button:active{background-color:#5a6ef0}dwg-chatbox #new-messages-container #new-messages-button #new-messages-number{font-weight:bold}dwg-chatbox #new-messages-container #new-messages-button.new-message{font-weight:bolder}dwg-chatbox #new-messages-container #new-messages-button.new-message #new-messages-number{font-weight:bolder}dwg-chatbox #input-container{--margin: 8px;--send-button-width: 70px;display:flex;flex-flow:row nowrap;height:var(--input-box-height);width:100%}dwg-chatbox #input-container>*{box-sizing:border-box;height:calc(100% - var(--margin));margin-top:var(--margin)}dwg-chatbox #input-container #chat-input{font-size:1rem;line-height:var(--input-box-height);padding-left:.5em;width:calc(100% - var(--send-button-width))}dwg-chatbox #input-container #send-chat{font-size:1rem;width:var(--send-button-width)}dwg-chatbox.transparent-fade{background-color:rgba(0,0,0,0);color:#fff}dwg-chatbox.transparent-fade #chat-container{background-color:rgba(80,80,80,.5);border-radius:1em;box-sizing:border-box;line-height:1.1em;padding:1em}dwg-chatbox.transparent-fade #chat-container>*{transition:background-color 1s}dwg-chatbox.transparent-fade #chat-container>*.new-message{background-color:rgba(70,70,70,.7);transition:none}dwg-chatbox.transparent-fade #input-container{background-color:rgba(0,0,0,0)}dwg-chatbox.transparent-fade #input-container #chat-input{background-color:rgba(90,90,90,.8);border:1px solid #fff;color:#fff}dwg-chatbox.transparent-fade #input-container #send-chat{background-color:rgba(0,0,0,0);color:#fff}dwg-chatbox.transparent-fade:not(.show){pointer-events:none}dwg-chatbox.transparent-fade:not(.show) #chat-container{background-color:rgba(0,0,0,0);transition:background-color 1s .1s}dwg-chatbox.transparent-fade:not(.show).new-message{color:#fff}dwg-chatbox.transparent-fade:not(.show):not(.new-message){color:rgba(0,0,0,0);transition:color 1.5s 2s}dwg-chatbox.transparent-fade:not(.show) #input-container{display:none}",""]);const r=a},125:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,".dwg-dialog-box{align-items:center;background-color:rgba(120,120,120,.8);bottom:0;display:flex;left:0;justify-content:center;position:absolute;right:0;top:0;z-index:100}",""]);const r=a},411:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-message-dialog #wrapper{align-items:center;background-color:#646464;color:#fff;display:flex;flex-flow:column nowrap;height:35vh;gap:1em;max-height:400px;max-width:500px;min-height:220px;min-width:220px;padding:1em;position:relative;width:35vw}dwg-message-dialog #wrapper #ok-button{color:#000;margin-top:auto;padding:.3em .6em}",""]);const r=a},630:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,".dwg-element:not(.parsed){display:none}",""]);const r=a},713:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-fiddlesticks #table-container{background-color:#8c4614;height:50%;position:relative;width:100%}dwg-fiddlesticks #table-container #header-message{display:flex;flex-flow:row wrap;gap:3em;left:1em;position:absolute;top:1em}dwg-fiddlesticks #table-container #trump-card-container{--width: calc(max(50px, min(200px, 15vw)));--height: calc(1.5em + var(--card-image-scale) * var(--width));height:var(--height);line-height:1.5em;position:absolute;right:4em;text-align:center;top:2em;width:var(--width)}dwg-fiddlesticks #table-container #trump-card-container #trump-card{height:calc(var(--card-image-scale)*var(--width));position:absolute;right:calc(50% - .5*var(--width));width:var(--width)}dwg-fiddlesticks #table-container #trump-card-container #trump-card #trump-card-img{height:100%;width:100%}dwg-fiddlesticks #player-container{background-color:#5a5a5a;display:flex;flex-flow:row nowrap;gap:3px;height:50%;justify-content:center;width:100%}dwg-fiddlesticks #player-container>*{border:1px solid #000;flex:1 1 0;height:100%;max-width:25vw}",""]);const r=a},494:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-fiddlesticks-player{display:flex;flex-flow:column nowrap;gap:.4em;position:relative;z-index:2}dwg-fiddlesticks-player>*{margin-left:2px;z-index:2}dwg-fiddlesticks-player #card-played-container{--width: calc(max(35px, min(150px, 12vw)));--height: calc(var(--card-image-scale) * var(--width));height:var(--height);left:calc(50% - .5*var(--width));position:absolute;top:calc(-1*var(--height));width:var(--width);z-index:1}dwg-fiddlesticks-player #card-played-container:not(.show){display:none}dwg-fiddlesticks-player #card-played-container #card-played{height:100%;width:100%}dwg-fiddlesticks-player #card-played-coverer{background-color:#5a5a5a;bottom:0;left:0;position:absolute;right:0;top:0}dwg-fiddlesticks-player #name-container-wrapper{display:flex;flex-flow:row nowrap;justify-content:center;margin-top:.4em;margin-bottom:.8em}dwg-fiddlesticks-player #name-container-wrapper #dealer-container:not(.show){display:none}dwg-fiddlesticks-player .fixed-width{display:inline-block;width:30%}dwg-fiddlesticks-player #cards-container{margin-top:.6em;z-index:3}dwg-fiddlesticks-player #cards-container .card{box-sizing:border-box;margin:.2em;padding-left:1.5em;position:relative;user-select:none}dwg-fiddlesticks-player #cards-container .card .card-img{--width: calc(max(35px, min(150px, 12vw)));--height: calc(var(--card-image-scale) * var(--width));display:none;left:5%;height:var(--height);position:absolute;top:100%;width:var(--width);z-index:4}dwg-fiddlesticks-player #cards-container .card:hover{background-color:rgba(255,255,255,.15)}dwg-fiddlesticks-player #cards-container .card:hover .card-img{display:block}dwg-fiddlesticks-player #cards-container .card:active{background-color:rgba(255,255,255,.3)}dwg-fiddlesticks-player #cards-container .card:active .card-img{display:block}dwg-fiddlesticks-player #betting-container:not(.show){display:none}dwg-fiddlesticks-player #winner-icon{height:64px;left:min(10%,10px);opacity:80%;position:absolute;rotate:-30deg;top:-48px;width:64px}dwg-fiddlesticks-player #winner-icon:not(.show){display:none}",""]);const r=a},415:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-game{--card-image-scale: 1.452;--header-height: 1.5em;background-color:#000}dwg-game #header{background-color:#323232;display:flex;flex-flow:row nowrap;height:var(--header-height);max-height:var(--header-height);min-height:var(--header-height);width:100%}dwg-game #header *{line-height:var(--header-height)}dwg-game #header #client-name{margin-left:1em}dwg-game #header #room-name,dwg-game #header #game-name{margin-left:3em}dwg-game #header #button-container{align-items:center;display:flex;flex-flow:row nowrap;gap:2px;justify-content:center;margin-left:auto;margin-right:4px}dwg-game #header #button-container button{border-radius:0;height:var(--header-height);padding:0;width:calc(1.3*var(--header-height))}dwg-game #header #button-container button img{height:100%;width:76.9230769231%}dwg-game #waiting-room{align-items:center;background-color:#964007;display:flex;height:calc(100% - var(--header-height));justify-content:center}dwg-game #waiting-room.hide{display:none}dwg-game #waiting-room .player-waiting{display:flex;flex-flow:row nowrap;font-size:18px;gap:1em;margin:.3em 0}dwg-game #waiting-room .player-waiting :last-child{margin-left:auto}dwg-game #waiting-room .player-waiting .connected{color:#64ff64}dwg-game #game-container{height:calc(100% - var(--header-height))}dwg-game #game-container:not(.show){display:none}dwg-game #chatbox-container{background-color:rgba(0,0,0,0);height:75vh;left:3px;position:absolute;top:10vh;width:50vw;z-index:9}dwg-game #chatbox-container:not(.showing){pointer-events:none}",""]);const r=a},365:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-game-history-dialog #wrapper{align-items:center;background-color:#646464;border-radius:8px;color:#fff;height:80vh;max-height:1200px;max-width:800px;min-height:300px;min-width:250px;padding:1em;position:relative;width:80vw}dwg-game-history-dialog #wrapper #close-button{background-color:rgba(0,0,0,0);border:none;border-top-right-radius:8px;height:36px;margin:0;padding:0;position:absolute;right:0;top:0;width:36px}dwg-game-history-dialog #wrapper #close-button:hover{background-color:rgba(255,100,100,.6)}dwg-game-history-dialog #wrapper #close-button:active{background-color:rgba(255,180,180,.8)}dwg-game-history-dialog #wrapper #updates-container{margin-top:36px;width:100%}",""]);const r=a},732:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-lobby{--name-header-height: 30px;--buttons-height: 50px;--chat-height: 200px;background-color:#143c78;display:flex;flex-flow:column nowrap}dwg-lobby.hide{display:none}dwg-lobby #page-header{background-color:#001e3c;box-sizing:border-box;display:block;font-size:18px;height:var(--name-header-height);line-height:var(--name-header-height);max-height:var(--name-header-height);min-height:var(--name-header-height);padding-left:1.5em;width:100%}dwg-lobby #page-header #ping-container{margin-left:2em}dwg-lobby #buttons{background-color:#0a3264;border-bottom:2px solid #000;box-sizing:border-box;display:flex;flex-flow:row nowrap;gap:8px;height:var(--buttons-height);max-height:var(--buttons-height);min-height:var(--buttons-height);width:100%}dwg-lobby #buttons>button{background-color:rgba(0,0,0,0);border:none;border-radius:16px;color:#fff;font-size:20px;padding:8px;transition:background-color 200ms,border-radius 200ms}dwg-lobby #buttons>button:hover:not(:disabled){background-color:rgba(50,100,200,.2)}dwg-lobby #buttons>button:active:not(:disabled){background-color:rgba(70,140,250,.4);border-radius:0px}dwg-lobby #buttons>button:disabled{background-color:rgba(150,150,150,.6);border-radius:8px;transition:none}dwg-lobby #horizontal-container{display:flex;flex-flow:row nowrap;flex:1 0 0;width:100%}dwg-lobby #horizontal-container #vertical-container{display:flex;flex-flow:column nowrap;flex:1 0 0;height:100%}dwg-lobby #horizontal-container #vertical-container #lobby-rooms{box-sizing:border-box;flex:1 0 0;padding:12px}dwg-lobby #horizontal-container #vertical-container #chatbox{box-sizing:border-box;height:var(--chat-height);max-height:var(--chat-height);min-height:var(--chat-height);padding:12px}dwg-lobby #horizontal-container #lobby-users{background-color:#0a1e32;box-sizing:border-box;height:100%;padding:8px;width:250px}dwg-lobby #lobby-room-wrapper{background-color:rgba(150,150,150,.5);bottom:0;left:0;position:absolute;right:0;top:0}dwg-lobby #lobby-room-wrapper:not(.show){display:none}dwg-lobby #lobby-room-wrapper #lobby-room{box-sizing:border-box;height:70vh;margin:15vh auto;padding:8px;width:70vw}dwg-lobby #lobby-connected-wrapper{align-items:center;background-color:rgba(150,150,150,.5);bottom:0;display:flex;font-size:3vw;justify-content:center;left:0;position:absolute;right:0;top:0;z-index:2}dwg-lobby.connected #lobby-connected-wrapper{display:none}dwg-lobby.connector-open #connecting-message{display:none}",""]);const r=a},11:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-lobby-connector{height:100%;left:0px;position:absolute;top:0px;width:100%;z-index:3}dwg-lobby-connector.hide{display:none}dwg-lobby-connector #card{background-color:#dcdcdc;color:#000;height:200px;left:calc(50% - 100px);padding:16px;position:relative;top:calc(50% - 150px);width:300px}dwg-lobby-connector #card #nickname{font-size:24px;margin-top:20px;width:290px}dwg-lobby-connector #card #connect-button{font-size:24px;margin-top:50px;width:290px}",""]);const r=a},923:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-lobby-game-settings{background-color:rgba(150,150,150,.4);bottom:0;left:0;position:absolute;right:0;top:0}dwg-lobby-game-settings:not(.show){display:none}dwg-lobby-game-settings #game-settings-wrapper{background-color:#d3d3d3;box-sizing:border-box;color:#000;display:flex;flex-flow:column nowrap;gap:12px;height:50vh;margin:25vh auto;padding:8px;width:50vw}dwg-lobby-game-settings #game-settings-wrapper *{font-size:18px;line-height:18px}dwg-lobby-game-settings #game-settings-wrapper label{font-size:.8rem}dwg-lobby-game-settings #game-settings-wrapper .row-wrapper{display:flex;flex-flow:row nowrap;gap:8px}dwg-lobby-game-settings #game-settings-wrapper .row-wrapper.label-row{margin-bottom:-10px}dwg-lobby-game-settings #game-settings-wrapper .row-wrapper>*{flex:1 0 0;min-width:0}dwg-lobby-game-settings #game-settings-wrapper #game-specific-settings{display:flex;flex-flow:column nowrap;gap:12px;height:fit-content}",""]);const r=a},991:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-lobby-room{background-color:#5ab4fa;box-shadow:0px 0px 3px 4px rgba(70,140,210,.8),0px 0px 6px 8px rgba(50,100,170,.8),0px 0px 9px 12px rgba(30,60,130,.8);display:flex;flex-flow:column nowrap;gap:8px}dwg-lobby-room:not(.show){display:none}dwg-lobby-room #room-header{background-color:#3c78d2;display:flex;flex-flow:row nowrap;height:36px;width:100%}dwg-lobby-room #room-header #room-name{flex:1 0 0;font-size:24px;height:100%;line-height:36px;padding-left:8px}dwg-lobby-room #room-header #room-name:not(.show){display:none}dwg-lobby-room #room-header #rename-input{box-sizing:border-box;flex:1 0 0;font-size:24px;height:100%;line-height:36px;padding-left:8px}dwg-lobby-room #room-header #rename-input:not(.show){display:none}dwg-lobby-room #room-header #rename-room:not(.show){display:none}dwg-lobby-room #room-header #cancel-rename{font-size:18px;width:80px}dwg-lobby-room #room-header #cancel-rename:not(.show){display:none}dwg-lobby-room #room-header>button{background-color:rgba(0,0,0,0);border:none;border-radius:6px;height:100%;margin:0px;padding:0px;width:36px}dwg-lobby-room #room-header>button:hover{background-color:rgba(220,220,220,.5)}dwg-lobby-room #room-header>button:active{background-color:rgba(220,220,220,.8)}dwg-lobby-room #room-body{display:flex;flex-flow:row nowrap;flex:1 0 0;width:100%}dwg-lobby-room #room-body #left-panel{background-color:#1e5ab4;display:flex;flex-flow:column nowrap;flex:0 0 320px;height:100%}dwg-lobby-room #room-body #left-panel #game-settings{box-sizing:border-box;flex:3 0 0;height:100%;overflow-y:auto;padding:8px 12px 0px;width:100%}dwg-lobby-room #room-body #left-panel #game-settings>*{box-sizing:border-box;min-height:1em;padding:4px;width:100%}dwg-lobby-room #room-body #left-panel #game-settings .settings-small{font-size:14px;line-height:14px}dwg-lobby-room #room-body #left-panel #game-settings .settings-medium{font-size:16px;line-height:16px}dwg-lobby-room #room-body #left-panel #game-settings .settings-large{font-size:18px;line-height:18px;margin-top:12px}dwg-lobby-room #room-body #left-panel #game-settings #settings-button-container{display:flex;flex-flow:row nowrap;gap:12px;margin-bottom:12px}dwg-lobby-room #room-body #left-panel #game-settings #settings-button-container.hide{display:none}dwg-lobby-room #room-body #left-panel #game-settings #settings-button-container .settings-button{font-size:18px;line-height:18px;height:30px;width:90px}dwg-lobby-room #room-body #left-panel #game-settings #settings-button-container .settings-button#settings-settings-button{background:linear-gradient(0deg, rgb(140, 140, 140), rgb(220, 220, 220));margin-left:auto}dwg-lobby-room #room-body #left-panel #game-settings #settings-button-container .settings-button#settings-launch-button{background:linear-gradient(0deg, rgb(40, 150, 40), rgb(80, 250, 80));margin-right:auto}dwg-lobby-room #room-body #left-panel #game-settings #settings-button-container .settings-button#settings-launch-button.launching{background:linear-gradient(0deg, rgb(50, 120, 50), rgb(100, 200, 100))}dwg-lobby-room #room-body #left-panel #game-settings #game-button-container{display:flex;flex-flow:row nowrap;gap:12px;margin-bottom:12px}dwg-lobby-room #room-body #left-panel #game-settings #game-button-container.hide{display:none}dwg-lobby-room #room-body #left-panel #game-settings #game-button-container .game-button{font-size:18px;line-height:18px;height:30px;width:90px}dwg-lobby-room #room-body #left-panel #game-settings #game-button-container .game-button#game-resign-button{background:linear-gradient(0deg, rgb(200, 25, 25), rgb(230, 60, 60));margin-left:auto}dwg-lobby-room #room-body #left-panel #game-settings #game-button-container .game-button#game-rejoin-button{background:linear-gradient(0deg, rgb(180, 180, 35), rgb(210, 210, 60));margin-right:auto}dwg-lobby-room #room-body #left-panel #game-settings #settings-settings{display:flex;flex-flow:column nowrap;gap:.3em}dwg-lobby-room #room-body #left-panel #user-list{background-color:rgba(220,220,220,.3);display:flex;flex-flow:column nowrap;flex:2 0 0}dwg-lobby-room #room-body #left-panel #user-list .container-label{background-color:rgba(220,220,220,.4);font-size:20px;height:24px;line-height:24px;margin-bottom:2px;margin-top:6px;padding:6px 12px 0px}dwg-lobby-room #room-body #left-panel #user-list .room-user{--user-height: 22px;display:flex;flex-flow:row nowrap;font-size:18px;gap:6px;height:var(--user-height);line-height:var(--user-height);padding:3px 6px;user-select:none}dwg-lobby-room #room-body #left-panel #user-list .room-user:hover{background-color:rgba(255,255,255,.2)}dwg-lobby-room #room-body #left-panel #user-list .room-user:hover>button{visibility:visible}dwg-lobby-room #room-body #left-panel #user-list .room-user :nth-child(2){margin-left:auto}dwg-lobby-room #room-body #left-panel #user-list .room-user>button{background-color:rgba(220,220,220,.5);border:none;border-radius:4px;display:inline-block;height:var(--user-height);margin:0px;padding:0px;visibility:hidden;width:var(--user-height)}dwg-lobby-room #room-body #left-panel #user-list .room-user>button:hover{background-color:rgba(250,250,250,.6)}dwg-lobby-room #room-body #left-panel #user-list .room-user>button:active{background-color:rgba(255,255,255,.7)}dwg-lobby-room #room-body #chatbox{box-sizing:border-box;flex:1 0 0;padding:8px}dwg-lobby-room #kick-img,dwg-lobby-room #promote-img,dwg-lobby-room #viewer-img,dwg-lobby-room #player-img{display:none}",""]);const r=a},562:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-lobby-rooms{display:block}dwg-lobby-rooms>.lobby-room{margin:2px 0;width:100%}",""]);const r=a},651:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-room-selector{--height: 42px;background-color:rgba(0,0,0,0);display:flex;flex-flow:row nowrap;font-size:calc(.5*var(--height));height:var(--height);line-height:var(--height);position:relative;user-select:none}dwg-room-selector:hover{background-color:rgba(180,180,180,.15)}dwg-room-selector:hover #room-buttons{display:flex}dwg-room-selector #room-players{margin-left:.3em;text-align:left;width:3em}dwg-room-selector #room-game{--width: 8em;margin-left:1em;max-width:var(--width);min-width:var(--width);text-align:left;width:var(--width)}dwg-room-selector #room-name{margin-left:1em}dwg-room-selector #room-buttons{--margin: 6px;bottom:var(--margin);display:none;flex-flow:row nowrap;gap:var(--margin);position:absolute;right:var(--margin);top:var(--margin)}dwg-room-selector #room-buttons>button{--width: calc(var(--height) - 2 * var(--margin));background-color:rgba(240,240,240,.8);border:none;border-radius:var(--margin);display:inline-block;height:var(--width);margin:0;padding:0;width:var(--width)}dwg-room-selector #room-buttons>button:hover{background-color:rgba(250,250,250,.9)}dwg-room-selector #room-buttons>button:active{background-color:rgba(230,230,230,.7)}",""]);const r=a},391:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-lobby-users{display:flex;flex-flow:column nowrap}dwg-lobby-users #header{height:36px}dwg-lobby-users #header #refresh-button{background-color:rgba(0,0,0,0);border:none;border-radius:6px;height:30px;margin:0px;padding:0px;position:relative;top:3px;user-select:none;width:30px}dwg-lobby-users #header #refresh-button:hover{background-color:rgba(180,180,180,.15)}dwg-lobby-users #header #refresh-button:active{background-color:rgba(180,180,180,.3)}dwg-lobby-users #header #refresh-button #refresh-img{filter:invert(1);left:3px;position:absolute;top:3px;user-select:none}dwg-lobby-users #user-container{display:flex;flex-flow:column nowrap;flex:1 0 0}dwg-lobby-users #user-container .lobby-user{box-sizing:border-box;font-size:16px;height:22px;padding:2px;user-select:none;width:100%}dwg-lobby-users #user-container .lobby-user:hover{background-color:rgba(180,180,180,.15)}dwg-lobby-users #user-container .lobby-user:active{background-color:rgba(180,180,180,.3)}dwg-lobby-users #user-container .lobby-user.left{text-decoration:line-through}",""]);const r=a},706:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"dwg-page-home{--margin-size: 16px;--height: calc(100vh - 2 * var(--margin-size));--width: calc(100% - 2 * var(--margin-size));background-color:#05285a;display:block;height:var(--height);max-height:var(--height);max-width:var(--width);min-height:var(--height);min-width:var(--width);padding:var(--margin-size);width:var(--width)}dwg-page-home #lobby,dwg-page-home #game{bottom:0;left:0;overflow:hidden;position:absolute;right:0;top:0}dwg-page-home #game:not(.show){display:none}",""]);const r=a},197:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,"",""]);const r=a},99:(e,t,n)=>{n.d(t,{Z:()=>r});var i=n(81),o=n.n(i),s=n(645),a=n.n(s)()(o());a.push([e.id,'body{background-color:#000;color:#fff;font-family:"Fira Sans",sans-serif;margin:0;min-height:100vh;min-width:100%;padding:0}body ::-webkit-scrollbar{width:7px}body ::-webkit-scrollbar-track{background:rgba(0,0,0,0)}body ::-webkit-scrollbar-thumb{background:#7a5959;border:2px solid rgba(0,0,0,0);background-clip:padding-box;border-radius:7px}body ::-webkit-scrollbar-thumb:hover{background:#5c4646;border:none}body ::-webkit-scrollbar-thumb:active{background:#463535}',""]);const r=a},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,o,s){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(i)for(var r=0;r<this.length;r++){var d=this[r][0];null!=d&&(a[d]=!0)}for(var l=0;l<e.length;l++){var c=[].concat(e[l]);i&&a[c[0]]||(void 0!==s&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=s),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),t.push(c))}},t}},81:e=>{e.exports=function(e){return e[1]}},91:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},379:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var s={},a=[],r=0;r<e.length;r++){var d=e[r],l=i.base?d[0]+i.base:d[0],c=s[l]||0,m="".concat(l," ").concat(c);s[l]=c+1;var h=n(m),g={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==h)t[h].references++,t[h].updater(g);else{var u=o(g,i);i.byIndex=r,t.splice(r,0,{identifier:m,updater:u,references:1})}a.push(m)}return a}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var s=i(e=e||[],o=o||{});return function(e){e=e||[];for(var a=0;a<s.length;a++){var r=n(s[a]);t[r].references--}for(var d=i(e,o),l=0;l<s.length;l++){var c=n(s[l]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}s=d}}},569:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},449:(e,t,n)=>{e.exports=n.p+"efe4c9fa82cefdec8b1d.png"},474:(e,t,n)=>{e.exports=n.p+"5c0badfd21808b14f424.png"},496:(e,t,n)=>{e.exports=n.p+"e929e15745a5bc384268.png"},255:(e,t,n)=>{e.exports=n.p+"c3cb371e1616269849ad.png"},668:(e,t,n)=>{e.exports=n.p+"9450fc5737760e0abbf9.png"},525:(e,t,n)=>{e.exports=n.p+"3af7da2d4c114edd8c83.png"},816:(e,t,n)=>{e.exports=n.p+"7f6d3fc00d6841ca158b.png"},621:(e,t,n)=>{e.exports=n.p+"9cc772be7d4d2437a8de.png"},637:(e,t,n)=>{e.exports=n.p+"9b22161f83ea9e9a0e76.png"},364:(e,t,n)=>{e.exports=n.p+"4b3f87b66da56a68a450.png"},36:(e,t,n)=>{e.exports=n.p+"cc2aeeb6cac4831124d8.png"},861:(e,t,n)=>{e.exports=n.p+"8787734a93d781fa44ad.png"}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={id:i,exports:{}};return e[i](s,s.exports,n),s.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="dist/",n.b=document.baseURI||self.location.href,n.nc=void 0,(()=>{var e=n(379),t=n.n(e),i=n(795),o=n.n(i),s=n(569),a=n.n(s),r=n(565),d=n.n(r),l=n(216),c=n.n(l),m=n(589),h=n.n(m),g=n(99),u={};u.styleTagTransform=h(),u.setAttributes=d(),u.insert=a().bind(null,"head"),u.domAPI=o(),u.insertStyleElement=c(),t()(g.Z,u),g.Z&&g.Z.locals&&g.Z.locals;var p=n(197),b={};b.styleTagTransform=h(),b.setAttributes=d(),b.insert=a().bind(null,"head"),b.domAPI=o(),b.insertStyleElement=c(),t()(p.Z,b),p.Z&&p.Z.locals&&p.Z.locals;function _(e,t=300){const n=i=>{e()?i():setTimeout((()=>n(i)),t)};return new Promise(n)}function y(e){return e.trim().split(" ").map((e=>{const t=e.toLowerCase();return e.charAt(0).toUpperCase()+t.slice(1)})).join(" ")}function v(e,t,n={}){const i=Object.assign({loading_text:void 0,disable_button:!0,re_enable_button:!0},n);e.addEventListener("click",(()=>{function n(t,n){"string"==typeof t&&(e.innerText=t),n&&(e.disabled=!1)}i.disable_button&&(e.disabled=!0),e.innerText,n(i.loading_text);const o=t();o instanceof Promise?o.then((e=>{n(e,i.re_enable_button)})):n(o,i.re_enable_button)}))}var f=n(630),w={};w.styleTagTransform=h(),w.setAttributes=d(),w.insert=a().bind(null,"head"),w.domAPI=o(),w.insertStyleElement=c(),t()(f.Z,w),f.Z&&f.Z.locals&&f.Z.locals;class x extends HTMLElement{constructor(){super(...arguments),this.fully_parsed=!1,this.elsMetadata=[]}connectedCallback(){return e=this,t=void 0,i=function*(){this.classList.add("dwg-element"),this.innerHTML=this.htmlString,yield _(this.elementsParsed.bind(this)),this.parsedCallback(),this.classList.add("parsed"),this.fully_parsed=!0},new((n=void 0)||(n=Promise))((function(o,s){function a(e){try{d(i.next(e))}catch(e){s(e)}}function r(e){try{d(i.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}d((i=i.apply(e,t||[])).next())}));var e,t,n,i}elementsParsed(){let e=!0;for(const t of this.elsMetadata){let n=t.found_element?this[t.name]:null;t.found_element||(n=this.querySelector(`#${t.element_id}`),n&&(this[t.name]=n,t.found_element=!0)),t.found_element?n instanceof x&&(n.fully_parsed||(e=!1)):e=!1}return e}parsedCallback(){}configureElement(e,t){t||(t=e.replace(/_/g,"-")),this.elsMetadata.push({element_id:t,name:e})}}var k=n(59),E={};E.styleTagTransform=h(),E.setAttributes=d(),E.insert=a().bind(null,"head"),E.domAPI=o(),E.insertStyleElement=c(),t()(k.Z,E),k.Z&&k.Z.locals&&k.Z.locals;const L="!!server!!";class S extends x{constructor(){super(),this.last_new_messages_button_count=0,this.new_chat_elements=[],this.htmlString='<div id="chat-container"></div> <div id="new-messages-container"> <button id="new-messages-button">New Messages (<span id="new-messages-number"></span>)</button> </div> <div id="input-container"> <input id="chat-input" placeholder=""> <button id="send-chat">Send</button> </div>',this.configureElement("chat_container"),this.configureElement("chat_input"),this.configureElement("send_chat"),this.configureElement("new_messages_button"),this.configureElement("new_messages_number")}parsedCallback(){v(this.send_chat,(()=>{this.sendChat()})),this.chat_input.addEventListener("keyup",(e=>{"Enter"===e.key&&this.sendChat()})),this.new_messages_button.addEventListener("click",(()=>{this.adjustScroll()})),this.chat_container.addEventListener("scroll",(()=>{this.scrolledUp()||this.scrolledToBottom()}))}scrolledUp(){return this.chat_container.scrollHeight-this.chat_container.offsetHeight-this.chat_container.scrollTop>S.adjust_scroll_limit}adjustScroll(){this.chat_container.scrollTop=this.chat_container.scrollHeight-this.chat_container.offsetHeight,this.scrolledToBottom()}scrolledToBottom(){this.last_new_messages_button_count=0,this.new_messages_button.classList.remove("show")}addChat(e,t=!1){const n=e.sender&&e.sender!==L?`${e.sender}: `:"",i=document.createElement("div");e.sender!==L&&"gray"!==e.color||i.classList.add("color-gray"),i.innerHTML=`<b>${n}</b>${e.message}`,this.chat_container.appendChild(i);const o=this.scrolledUp();i.classList.add("new-message"),this.new_chat_elements.push(i),this.classList.add("new-message"),this.last_new_messages_button_timer&&clearTimeout(this.last_new_messages_button_timer),t||!o?this.adjustScroll():(this.new_messages_button.classList.add("show"),this.new_messages_button.classList.add("new-message"),this.last_new_messages_button_count++,this.new_messages_number.innerText=this.last_new_messages_button_count.toString()),setTimeout((()=>{this.new_messages_button.classList.remove("new-message"),this.new_chat_elements.forEach((e=>{e.classList.remove("new-message")})),this.classList.remove("new-message")}),1500)}sendChat(){if(this.inputEmpty())return;const e=new CustomEvent("chat_sent",{detail:this.getInput()});this.dispatchEvent(e)}setPlaceholder(e){this.chat_input.placeholder=e}focus(){this.chat_input.focus()}clear(){this.chat_input.value="",this.chat_container.innerHTML=""}inputEmpty(){return!this.chat_input.value}getInput(){const e={message:this.chat_input.value};return this.chat_input.value="",e}}function T(e,t,n,i){return JSON.stringify({sender:e,kind:t,content:n,data:i})}function C(e){var t;return{client_id:parseInt(e.client_id),nickname:e.nickname,ping:parseInt(e.ping),room_id:null!==(t=parseInt(e.room_id))&&void 0!==t?t:void 0}}var R;function I(e){return{game_type:parseInt(e.game_type),max_players:parseInt(e.max_players),max_viewers:parseInt(e.max_viewers)}}function $(e){return{room_id:parseInt(e.room_id),room_name:e.room_name,host:C(e.host),players:new Map(e.players.map((e=>{const t=C(e);return[t.client_id,t]}))),viewers:new Map(e.viewers.map((e=>{const t=C(e);return[t.client_id,t]}))),game_settings:I(e.game_settings),game_id:e.game_id?parseInt(e.game_id):void 0}}S.adjust_scroll_limit=5,customElements.define("dwg-chatbox",S),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.FIDDLESTICKS=1]="FIDDLESTICKS"}(R||(R={}));var U=n(732),Z={};Z.styleTagTransform=h(),Z.setAttributes=d(),Z.insert=a().bind(null,"head"),Z.domAPI=o(),Z.insertStyleElement=c(),t()(U.Z,Z),U.Z&&U.Z.locals&&U.Z.locals;var P=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function a(e){try{d(i.next(e))}catch(e){s(e)}}function r(e){try{d(i.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}d((i=i.apply(e,t||[])).next())}))};function j(e){return`/api/${e}/`}function A(e){return P(this,void 0,void 0,(function*(){try{const t=yield fetch(j(e),{method:"GET",headers:{"Content-Type":"application/json"}});return yield t.json()}catch(e){console.log(e)}return{success:!1,error_message:"Server error; please report this bug."}}))}var z=n(91),N=n.n(z),M=new URL(n(861),n.b);const D='<div id="header"> <button id="refresh-button"> <img id="refresh-img" src="'+N()(M)+'" alt="refresh" draggable="false"> </button> </div> <div id="user-container"></div>';var O=n(391),H={};H.styleTagTransform=h(),H.setAttributes=d(),H.insert=a().bind(null,"head"),H.domAPI=o(),H.insertStyleElement=c(),t()(O.Z,H),O.Z&&O.Z.locals&&O.Z.locals;customElements.define("dwg-lobby-users",class extends x{constructor(){super(),this.users=new Map,this.refresh_users_running=!1,this.htmlString=D,this.configureElement("refresh_button"),this.configureElement("user_container")}parsedCallback(){v(this.refresh_button,(()=>{this.refreshUsers()}),{}),this.refreshUsers()}refreshUsers(){return e=this,t=void 0,i=function*(){if(this.refresh_users_running)return;this.refresh_users_running=!0,this.user_container.innerHTML=" ... loading",this.users.clear();const e=yield A("lobby/users/get");if(e.success){let t="";for(const n of e.result){const e=C(n);t+=this.addUserString(e),this.users.set(e.client_id,e)}this.user_container.innerHTML=t}else this.user_container.innerHTML=`Error loading users: ${e.error_message}`;this.refresh_users_running=!1},new((n=void 0)||(n=Promise))((function(o,s){function a(e){try{d(i.next(e))}catch(e){s(e)}}function r(e){try{d(i.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}d((i=i.apply(e,t||[])).next())}));var e,t,n,i}addUserString(e){return`<div class="lobby-user" id="user-${e.client_id}">${this.getUserInnerText(e)}</div>`}getUserInnerText(e){return`${e.nickname} (${e.ping})`}addUser(e){if(this.users.has(e.client_id)){const t=this.querySelector(`#user-${e.client_id}`);t&&t.replaceWith(this.addUserString(e))}else this.user_container.innerHTML+=this.addUserString(e);this.users.set(e.client_id,e)}updatePing(e,t){if(this.users.has(e)){this.users.get(e).ping=t;const n=this.querySelector(`#user-${e}`);n&&(n.innerText=this.getUserInnerText(this.users.get(e)))}}removeUser(e){this.users.delete(e);const t=this.querySelector(`#user-${e}`);t&&t.classList.add("left")}getUser(e){return this.users.get(e)}joinRoom(e,t){const n=this.getUser(e);n&&(n.room_id=t)}leaveRoom(e){const t=this.getUser(e);t&&(t.room_id=void 0)}});var G=n(562),B={};B.styleTagTransform=h(),B.setAttributes=d(),B.insert=a().bind(null,"head"),B.domAPI=o(),B.insertStyleElement=c(),t()(G.Z,B),G.Z&&G.Z.locals&&G.Z.locals;var J=new URL(n(364),n.b),F=new URL(n(525),n.b);const q='<div id="room-players"> <span id="room-curr-players"></span>/<span id="room-max-players"></span> </div> <div id="room-game"></div> <div id="room-name"></div> <div id="room-buttons"> <button id="button-join-player"> <img src="'+N()(J)+'" alt="Join" draggable="false"> </button> <button id="button-join-viewer"> <img src="'+N()(F)+'" alt="Join" draggable="false"> </button> </div>';var W=n(651),K={};K.styleTagTransform=h(),K.setAttributes=d(),K.insert=a().bind(null,"head"),K.domAPI=o(),K.insertStyleElement=c(),t()(W.Z,K),W.Z&&W.Z.locals&&W.Z.locals,customElements.define("dwg-room-selector",class extends x{constructor(){super(),this.htmlString=q,this.configureElement("room_name"),this.configureElement("room_curr_players"),this.configureElement("room_max_players"),this.configureElement("room_game"),this.configureElement("button_join_player"),this.configureElement("button_join_viewer")}parsedCallback(){this.setRoomData(),this.addEventListener("dblclick",(()=>{this.dispatchEvent(new Event("join_room"))})),this.button_join_player.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("join_room",{detail:!0}))})),this.button_join_viewer.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("join_room",{detail:!1}))}))}setRoom(e){this.room=e,this.fully_parsed&&this.setRoomData()}setRoomData(){var e,t,n,i;this.room&&(this.room_curr_players.innerText=null===(e=this.room.players)||void 0===e?void 0:e.size.toString(),this.room_max_players.innerText=null===(n=null===(t=this.room.game_settings)||void 0===t?void 0:t.max_players)||void 0===n?void 0:n.toString(),this.room_name.innerText=this.room.room_name,this.room_game.innerText=y((null!==(i=R[this.room.game_settings.game_type||-1])&&void 0!==i?i:"").toLowerCase()))}});var V=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function a(e){try{d(i.next(e))}catch(e){s(e)}}function r(e){try{d(i.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}d((i=i.apply(e,t||[])).next())}))};customElements.define("dwg-lobby-rooms",class extends x{constructor(){super(),this.lock=function(){let e=!1;const t=[];return n=>{let i,o;const s=new Promise(((e,t)=>{i=e,o=t})),a=()=>{return s=this,a=void 0,d=function*(){yield n().then(i,o);const s=t.shift();s?yield s():e=!1},new((r=void 0)||(r=Promise))((function(e,t){function n(e){try{o(d.next(e))}catch(e){t(e)}}function i(e){try{o(d.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r((function(e){e(o)}))).then(n,i)}o((d=d.apply(s,a||[])).next())}));var s,a,r,d};return e?t.push(a):(e=!0,a()),s}}(),this.rooms=new Map,this.htmlString=""}parsedCallback(){}refreshRooms(e){return V(this,void 0,void 0,(function*(){let t;return yield this.lock((()=>V(this,void 0,void 0,(function*(){this.innerHTML=" ... loading",this.rooms.clear();const n=yield A("lobby/rooms/get");if(n.success){const i=[];for(const o of n.result){const n=$(o);i.push(this.getRoomElement(n)),this.rooms.set(n.room_id,n),(n.players.has(e)||n.viewers.has(e))&&(t=n)}this.replaceChildren(...i)}else this.innerHTML=`Error loading rooms: ${n.error_message}`})))),t}))}getRoomElement(e){const t=document.createElement("dwg-room-selector");return t.classList.add("lobby-room"),t.id=`room-${e.room_id}`,t.setRoom(e),t.addEventListener("join_room",(t=>{var n;const i={detail:{room_id:e.room_id,join_as_player:null===(n=t.detail)||void 0===n||n}};this.dispatchEvent(new CustomEvent("join_room",i))})),t}addRoom(e){if(this.rooms.has(e.room_id)){const t=this.querySelector(`#room-${e.room_id}`);t&&t.replaceWith(this.getRoomElement(e))}else this.appendChild(this.getRoomElement(e));this.rooms.set(e.room_id,e)}removeRoom(e){this.rooms.delete(e);const t=this.querySelector(`#room-${e}`);t&&t.remove()}userDisconnected(e){const t=[];for(const n of this.rooms.values())e===n.host.client_id&&t.push(n.room_id);t.forEach((e=>this.removeRoom(e)))}getRoom(e){return this.rooms.get(e)}roomUpdated(e){const t=this.querySelector(`#room-${e.room_id}`);t&&t.setRoom(e)}renameRoom(e,t){const n=this.getRoom(e);n&&(n.room_name=t,this.roomUpdated(n))}promoteUser(e,t){const n=this.getRoom(e);n&&n.players.has(t)&&(n.host=n.players.get(t),this.roomUpdated(n))}playerToViewer(e,t){const n=this.getRoom(e);n&&n.players.has(t)&&(n.viewers.set(t,n.players.get(t)),n.players.delete(t),this.roomUpdated(n))}viewerToPlayer(e,t){const n=this.getRoom(e);n&&n.viewers.has(t)&&(n.players.set(t,n.viewers.get(t)),n.viewers.delete(t),this.roomUpdated(n))}playerJoinsRoom(e,t){const n=this.getRoom(t.room_id);if(e===t.room_id)return void(n&&(n.players.set(t.client_id,t),this.roomUpdated(n)));n&&(n.host.client_id===t.client_id?this.removeRoom(t.room_id):n.players.delete(t.client_id),this.roomUpdated(n));const i=this.getRoom(e);i&&(i.players.set(t.client_id,t),this.roomUpdated(i))}viewerJoinsRoom(e,t){const n=this.getRoom(t.room_id);n&&(n.host.client_id===t.client_id?this.removeRoom(t.room_id):n.players.delete(t.client_id),this.roomUpdated(n));const i=this.getRoom(e);i&&(i.viewers.set(t.client_id,t),this.roomUpdated(i))}clientLeavesRoom(e,t){const n=this.getRoom(e);n&&(n.host.client_id!==t||n.game_id?(n.players.delete(t),n.viewers.delete(t)):this.removeRoom(e),this.roomUpdated(n))}updateRoomSettings(e,t){const n=this.getRoom(e);n&&(n.game_settings=t,this.roomUpdated(n))}launchRoom(e,t){const n=this.getRoom(e);n&&(n.game_id=t,this.roomUpdated(n))}});var Q=new URL(n(255),n.b),X=new URL(n(474),n.b),Y=new URL(n(816),n.b),ee=new URL(n(36),n.b),te=new URL(n(668),n.b),ne=new URL(n(637),n.b);const ie='<div id="room-header"> <button id="rename-room"> <img src="'+N()(Q)+'" alt="rename" draggable="false"> </button> <button id="cancel-rename">cancel</button> <div id="room-name"></div> <input id="rename-input" placeholder="room name"> <button id="leave-room"> <img src="'+N()(X)+'" alt="close" draggable="false"> </button> </div> <div id="room-body"> <div id="left-panel"> <div id="game-settings"> <div id="settings-button-container" class="hide settings-medium"> <button id="settings-settings-button" class="settings-button">Settings</button> <button id="settings-launch-button" class="settings-button">Launch</button> </div> <div id="game-button-container" class="hide settings-medium"> <button id="game-resign-button" class="game-button">Resign</button> <button id="game-rejoin-button" class="game-button">Rejoin</button> </div> <dwg-lobby-game-settings id="lobby-game-settings"></dwg-lobby-game-settings> <div id="settings-title" class="settings-medium"></div> <div id="settings-players" class="settings-medium"> Players: <span id="num-players-current"></span>/<span id="num-players-max"></span> </div> <div id="settings-game-status" class="settings-small"></div> <div id="settings-settings-label" class="settings-large">Settings:</div> <div id="settings-settings"></div> <div id="settings-description-label" class="settings-large">Description:</div> <div id="settings-description" class="settings-small"></div> </div> <div id="user-list"> <div id="host-label" class="container-label">Host</div> <div id="host-container"></div> <div id="players-label" class="container-label">Players (<span id="players-label-amount">0</span>)</div> <div id="players-container"></div> <div id="viewers-label" class="container-label">Viewers (<span id="viewers-label-amount">0</span>)</div> <div id="viewers-container"></div> </div> </div> <dwg-chatbox id="chatbox"></dwg-chatbox> </div> <img id="kick-img" src="'+N()(Y)+'"> <img id="promote-img" src="'+N()(ee)+'"> <img id="viewer-img" src="'+N()(te)+'"> <img id="player-img" src="'+N()(ne)+'">';var oe=n(991),se={};se.styleTagTransform=h(),se.setAttributes=d(),se.insert=a().bind(null,"head"),se.domAPI=o(),se.insertStyleElement=c(),t()(oe.Z,se),oe.Z&&oe.Z.locals&&oe.Z.locals;var ae,re=n(923),de={};de.styleTagTransform=h(),de.setAttributes=d(),de.insert=a().bind(null,"head"),de.domAPI=o(),de.insertStyleElement=c(),t()(re.Z,de),re.Z&&re.Z.locals&&re.Z.locals,customElements.define("dwg-lobby-game-settings",class extends x{constructor(){super(),this.game_specific_settings_els=new Map,this.htmlString='<div id="game-settings-wrapper"> <div id="game-settings-title">Game Settings</div> <select id="game-chooser"><option value="0" selected="selected" hidden>--Choose a game--</option></select> <span class="row-wrapper label-row"> <label for="max-players-input">Max Players</label> <label for="max-viewers-input">Max Viewers</label> </span> <span class="row-wrapper"> <input id="max-players-input" type="number" min="1" max="8" placeholder="Max Players"> <input id="max-viewers-input" type="number" min="0" max="16" placeholder="Max Viewers"> </span> <div id="game-specific-settings"></div> <button id="save-button">Save</button> </div> ',this.configureElement("game_settings_wrapper"),this.configureElement("game_chooser"),this.configureElement("max_players_input"),this.configureElement("max_viewers_input"),this.configureElement("game_specific_settings"),this.configureElement("save_button")}parsedCallback(){for(const t of(e=R,Object.keys(e).filter((e=>Number.isNaN(parseInt(e)))))){if(!R[t])continue;const e=document.createElement("option");e.value=R[t].toString(),e.innerText=t,this.game_chooser.appendChild(e)}var e;v(this.save_button,(()=>{this.dispatchEvent(new Event("saved"))})),this.game_chooser.addEventListener("change",(()=>{var e;const t=null!==(e=parseInt(this.game_chooser.value))&&void 0!==e?e:0,n=this.getGameSpecificHTML(t);this.game_specific_settings.replaceChildren(...n)}))}getGameSpecificHTML(e){const t=[];if(this.game_specific_settings_els.clear(),e===R.FIDDLESTICKS){const[e,n]=this.createNumberElement("max-round","Override Max Round",1,12),[i,o]=this.createNumberElement("round-points","Round Points",0,20,10),[s,a]=this.createNumberElement("trick-points","Trick Points",0,10,1);t.push(this.createRowElement([n,o,a],!0)),t.push(this.createRowElement([e,i,s]))}return t}createNumberElement(e,t,n,i,o){const s=document.createElement("input");s.id=e,s.type="number",s.placeholder=t,s.min=n.toString(),s.max=i.toString(),void 0!==o&&(s.valueAsNumber=o);const a=document.createElement("label");return a.setAttribute("for",e),a.innerText=t,this.game_specific_settings_els.set(e,s),[s,a]}createRowElement(e,t=!1){const n=document.createElement("div");return n.classList.add("row-wrapper"),n.classList.toggle("label-row",t),n.replaceChildren(...e),n}setSettings(e){var t,n,i;this.game_chooser.value=e.game_type.toString(),this.max_players_input.valueAsNumber=e.max_players,this.max_viewers_input.valueAsNumber=e.max_viewers;try{if(e.game_type===R.FIDDLESTICKS){const o=e.game_specific_settings;this.game_specific_settings_els.has("max-round")&&(this.game_specific_settings_els.get("max-round").valueAsNumber=null!==(t=o.max_round)&&void 0!==t?t:0),this.game_specific_settings_els.has("round-points")&&(this.game_specific_settings_els.get("round-points").valueAsNumber=null!==(n=o.round_points)&&void 0!==n?n:0),this.game_specific_settings_els.has("trick-points")&&(this.game_specific_settings_els.get("trick-points").valueAsNumber=null!==(i=o.trick_points)&&void 0!==i?i:0)}}catch(e){console.log(e)}}clearSettings(){this.game_chooser.value="",this.max_players_input.value="",this.max_viewers_input.value="",this.game_specific_settings.replaceChildren(),this.game_specific_settings_els.clear()}getSettings(){var e,t,n;const i={game_type:parseInt(this.game_chooser.value)||0,max_players:this.max_players_input.valueAsNumber||0,max_viewers:this.max_viewers_input.valueAsNumber||0};return i.game_type===R.FIDDLESTICKS&&(i.game_specific_settings={max_round:(null===(e=this.game_specific_settings_els.get("max-round"))||void 0===e?void 0:e.valueAsNumber)||0,round_points:(null===(t=this.game_specific_settings_els.get("round-points"))||void 0===t?void 0:t.valueAsNumber)||0,trick_points:(null===(n=this.game_specific_settings_els.get("trick-points"))||void 0===n?void 0:n.valueAsNumber)||0}),i}}),function(e){e.NOT_STARTED="Game not started",e.LAUNCHING="Game launching ...",e.IN_PROGRESS="Game in progress"}(ae||(ae={})),customElements.define("dwg-lobby-room",class extends x{constructor(){super(),this.settings_launching=!1,this.is_host=!1,this.htmlString=ie,this.configureElement("room_name"),this.configureElement("chatbox"),this.configureElement("leave_room"),this.configureElement("rename_input"),this.configureElement("rename_room"),this.configureElement("cancel_rename"),this.configureElement("host_container"),this.configureElement("players_container"),this.configureElement("viewers_container"),this.configureElement("kick_img"),this.configureElement("promote_img"),this.configureElement("viewer_img"),this.configureElement("player_img"),this.configureElement("settings_title"),this.configureElement("num_players_current"),this.configureElement("num_players_max"),this.configureElement("settings_settings"),this.configureElement("settings_description"),this.configureElement("settings_button_container"),this.configureElement("settings_settings_button"),this.configureElement("settings_launch_button"),this.configureElement("settings_game_status"),this.configureElement("lobby_game_settings"),this.configureElement("game_button_container"),this.configureElement("game_resign_button"),this.configureElement("game_rejoin_button")}parsedCallback(){this.chatbox.setPlaceholder("Chat with room"),this.chatbox.addEventListener("chat_sent",(e=>{this.dispatchEvent(new CustomEvent("chat_sent",{detail:e.detail}))})),this.leave_room.addEventListener("click",(()=>{this.dispatchEvent(new Event("leave_room"))})),this.rename_room.addEventListener("click",(()=>{this.openRename()})),this.cancel_rename.addEventListener("click",(()=>{this.cancelRename()})),this.rename_input.addEventListener("keyup",(e=>{"Enter"===e.key&&this.submitRename()})),this.settings_settings_button.addEventListener("click",(()=>{this.lobby_game_settings.setSettings(this.room.game_settings),this.lobby_game_settings.classList.add("show")})),this.lobby_game_settings.addEventListener("saved",(()=>{const e=T(`client-${this.room.host.client_id}`,"room-settings-update",JSON.stringify(this.lobby_game_settings.getSettings()),this.room.room_id.toString());this.dispatchEvent(new CustomEvent("save_settings",{detail:e})),this.lobby_game_settings.classList.remove("show")})),this.settings_launch_button.addEventListener("click",(()=>{if(this.settings_launching)this.settings_launching=!1,this.settings_launch_button.innerText="Launch",this.settings_launch_button.classList.remove("launching"),this.settings_launch_interval_id&&clearInterval(this.settings_launch_interval_id);else{this.settings_launching=!0,this.settings_launch_button.innerText="Cancel",this.settings_launch_button.classList.add("launching"),this.settings_game_status.innerText=ae.LAUNCHING;const e=5;this.dispatchEvent(new CustomEvent("chat_sent",{detail:{message:`Game is launching in ${e} ...`,sender:L}})),this.settings_launch_interval_id=function(e,t,n,i=(()=>{})){let o=0;const s=setInterval((()=>{o++,o>n?(clearInterval(s),i()):e(o)}),1e3);return s}((t=>{this.dispatchEvent(new CustomEvent("chat_sent",{detail:{message:e-t+" ...",sender:L}}))}),0,e-1,(()=>{this.dispatchEvent(new CustomEvent("chat_sent",{detail:{message:"Game is launching ...",sender:L}})),this.dispatchEvent(new Event("launch_game")),this.settings_launch_button.disabled=!0}))}})),v(this.game_rejoin_button,(()=>{this.dispatchEvent(new Event("rejoin_game"))})),this.room_name.classList.add("show")}setRoom(e,t){const n=!!e.game_id;this.is_host=t,this.room=e,this.room_name.innerText=e.room_name,this.lobby_game_settings.setSettings(e.game_settings),this.updateSettingsDependencies(),this.num_players_current.innerText=e.players.size.toString(),this.settings_game_status.innerText=n?ae.IN_PROGRESS:ae.NOT_STARTED,this.classList.add("show"),n?this.game_button_container.classList.remove("hide"):(this.game_button_container.classList.add("hide"),t?(this.rename_room.classList.add("show"),this.settings_button_container.classList.remove("hide")):(this.rename_room.classList.remove("show"),this.settings_button_container.classList.add("hide"))),this.host_container.replaceChildren(this.getUserElement(e.host,!1,!0));const i=[];for(const n of e.players.values())n.client_id!==e.host.client_id&&i.push(this.getUserElement(n,t,!0));this.players_container.replaceChildren(...i);const o=[];for(const n of e.viewers.values())o.push(this.getUserElement(n,t,!1));this.viewers_container.replaceChildren(...o)}updateSettings(e){this.room&&(this.room.game_settings=e,this.updateSettingsDependencies())}updateSettingsDependencies(){var e;if(this.settings_title.innerText=null!==(e=R[this.room.game_settings.game_type||-1])&&void 0!==e?e:"",this.num_players_max.innerText=this.room.game_settings.max_players.toString(),this.room.game_settings.game_specific_settings){const e=[];for(const[t,n]of Object.entries(this.room.game_settings.game_specific_settings)){const i=document.createElement("div");i.classList.add("setting"),i.classList.add("settings-small"),i.id=`setting-${t}`,i.innerText=`${y(t.replace("_"," "))}: ${n}`,e.push(i)}this.settings_settings.replaceChildren(...e)}else this.settings_settings.replaceChildren()}getUserElement(e,t,n){const i=document.createElement("div");i.classList.add("room-user"),i.id=`user-${e.client_id}`;const o=document.createElement("span");return o.innerText=this.getUserElementText(e),i.appendChild(o),t&&!this.room.game_id&&(n?(i.appendChild(this.getUserButton(e.client_id,"kick",this.kick_img.src)),i.appendChild(this.getUserButton(e.client_id,"viewer",this.viewer_img.src)),i.appendChild(this.getUserButton(e.client_id,"promote",this.promote_img.src))):(i.appendChild(this.getUserButton(e.client_id,"kick",this.kick_img.src)),i.appendChild(this.getUserButton(e.client_id,"player",this.player_img.src)))),i}getUserButton(e,t,n){const i=document.createElement("button");i.id=`${t}-button-${e}`,i.classList.add(`${t}-button`);const o=document.createElement("img");return o.src=n,o.alt=t,o.draggable=!1,i.appendChild(o),i.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent(`${t}_player`,{detail:e}))})),i}getUserElementText(e){return`${e.nickname} (${e.ping})`}clearRoom(){this.room=void 0,this.lobby_game_settings.clearSettings(),this.chatbox.clear(),this.classList.remove("show")}renameRoom(e,t){this.room&&(this.room.room_name=e,this.room_name.innerText=e,t===this.room.host.client_id?this.chatbox.addChat({message:`The host has renamed the room to: ${e}`,color:"gray"}):this.room.players.has(t)?this.chatbox.addChat({message:`${this.room.players.get(t).nickname} renamed the room to: ${e}`,color:"gray"}):this.chatbox.addChat({message:`The room has been renamed to: ${e}`,color:"gray"}))}hasPlayer(e){return!(!this.classList.contains("show")||!this.room)&&this.room.players.has(e)}getClient(e){if(this.classList.contains("show")&&this.room)return this.room.players.has(e)?this.room.players.get(e):this.room.viewers.get(e)}getPlayer(e){if(this.classList.contains("show")&&this.room)return this.room.players.get(e)}getHost(){if(this.classList.contains("show")&&this.room)return this.room.host}updatePing(e,t){if(this.room&&this.room.players.has(e)){this.room.players.get(e).ping=t;const n=this.querySelector(`#user-${e} span`);n&&(n.innerText=this.getUserElementText(this.room.players.get(e)))}}joinRoom(e,t){if(!this.room)return;const n=this.querySelector(`#user-${e.client_id}`);n?n.replaceWith(this.getUserElement(e,this.is_host,!0)):t?this.players_container.appendChild(this.getUserElement(e,this.is_host,!0)):this.viewers_container.appendChild(this.getUserElement(e,this.is_host,!0)),t?(this.room.players.set(e.client_id,e),this.num_players_current.innerText=this.room.players.size.toString()):this.room.viewers.set(e.client_id,e),this.chatbox.addChat({message:`${e.nickname} (${e.client_id}) joined the room`,color:"gray"})}leaveRoom(e,t){var n;if(this.room)if(this.room.host.client_id===e)this.clearRoom();else{const i=null!==(n=this.room.players.get(e))&&void 0!==n?n:this.room.viewers.get(e);this.room.players.delete(e),this.room.viewers.delete(e),this.num_players_current.innerText=this.room.players.size.toString();const o=this.querySelector(`#user-${e}`);o&&o.remove(),i&&this.chatbox.addChat({message:`${i.nickname} (client id ${i.client_id}) ${t} the room`,color:"gray"})}}promoteUser(e,t){if(!this.room)return;const n=this.room.players.get(e);n&&(this.room.host=n,this.setRoom(this.room,t),this.chatbox.addChat({message:`${n.nickname} (client id ${n.client_id}) was promoted as host of room`,color:"gray"}))}playerToViewer(e){this.room&&this.room.players.has(e)&&(this.room.viewers.set(e,this.room.players.get(e)),this.room.players.delete(e),this.setRoom(this.room,this.is_host))}viewerToPlayer(e){this.room&&this.room.viewers.has(e)&&(this.room.players.set(e,this.room.viewers.get(e)),this.room.viewers.delete(e),this.setRoom(this.room,this.is_host))}launchRoom(e){this.room&&(this.room.game_id=e,this.settings_game_status.innerText=ae.IN_PROGRESS,this.game_button_container.classList.remove("hide"),this.settings_button_container.classList.add("hide"))}openRename(){this.rename_room.classList.remove("show"),this.room_name.classList.remove("show"),this.rename_input.value=this.room.room_name,this.rename_input.classList.add("show"),this.cancel_rename.classList.add("show")}cancelRename(){this.rename_room.classList.add("show"),this.room_name.classList.add("show"),this.rename_input.classList.remove("show"),this.cancel_rename.classList.remove("show")}submitRename(){this.dispatchEvent(new CustomEvent("rename_room",{detail:this.rename_input.value})),this.cancelRename()}});var le=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function a(e){try{d(i.next(e))}catch(e){s(e)}}function r(e){try{d(i.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}d((i=i.apply(e,t||[])).next())}))};customElements.define("dwg-lobby",class extends x{constructor(){super(),this.connection_metadata={nickname:"Anonymous",ping:0},this.waitingOnConnectedTimes=0,this.htmlString='<span id="page-header"> <span id="name-container"></span> <span id="ping-container"></span> </span> <span id="buttons"> <button id="refresh-lobby-button">Refresh</button> <button id="create-room-button">Create Room</button> </span> <span id="horizontal-container"> <span id="vertical-container"> <dwg-lobby-rooms id="lobby-rooms"></dwg-lobby-rooms> <dwg-chatbox id="chatbox"></dwg-chatbox> </span> <dwg-lobby-users id="lobby-users"></dwg-lobby-users> </span> <div id="lobby-room-wrapper"> <dwg-lobby-room id="lobby-room"></dwg-lobby-room> </div> <div id="lobby-connected-wrapper"> <div id="connecting-message">Connecting ...</div> </div>',this.configureElement("name_container"),this.configureElement("ping_container"),this.configureElement("refresh_lobby_button"),this.configureElement("create_room_button"),this.configureElement("lobby_rooms"),this.configureElement("chatbox"),this.configureElement("lobby_users"),this.configureElement("lobby_room_wrapper"),this.configureElement("lobby_room")}parsedCallback(){this.chatbox.setPlaceholder("Chat with the entire lobby"),v(this.refresh_lobby_button,(()=>le(this,void 0,void 0,(function*(){yield this.refreshLobbyRooms()})))),v(this.create_room_button,(()=>le(this,void 0,void 0,(function*(){this.socket.send(T(`client-${this.connection_metadata.client_id}`,"room-create"))}))),{loading_text:"Creating Room ...",re_enable_button:!1}),this.lobby_rooms.addEventListener("join_room",(e=>le(this,void 0,void 0,(function*(){this.socket.send(T(`client-${this.connection_metadata.client_id}`,e.detail.join_as_player?"room-join-player":"room-join-viewer","",e.detail.room_id.toString()))})))),this.chatbox.addEventListener("chat_sent",(e=>{this.sendChatMessage(this.chatbox,"lobby-chat",Object.assign(Object.assign({},e.detail),{sender:`client-${this.connection_metadata.client_id}`}),this.connection_metadata.nickname)})),this.lobby_room.addEventListener("chat_sent",(e=>{const t=e.detail,n=t.sender===L,i=n?t.sender:this.connection_metadata.nickname,o=`room-${this.connection_metadata.room_id}-${this.connection_metadata.client_id}`;t.sender=n?`${o}-${t.sender}`:o,this.sendChatMessage(this.lobby_room.chatbox,"room-chat",t,i)})),this.lobby_room.addEventListener("leave_room",(()=>le(this,void 0,void 0,(function*(){var e;this.socket.send(T(`client-${this.connection_metadata.client_id}`,"room-leave","",null===(e=this.connection_metadata.room_id)||void 0===e?void 0:e.toString()))})))),this.lobby_room.addEventListener("rename_room",(e=>{var t;this.socket.send(T(`client-${this.connection_metadata.client_id}`,"room-rename",e.detail,null===(t=this.connection_metadata.room_id)||void 0===t?void 0:t.toString()))})),this.lobby_room.addEventListener("kick_player",(e=>{var t;this.socket.send(T(`client-${this.connection_metadata.client_id}`,"room-kick",e.detail.toString(),null===(t=this.connection_metadata.room_id)||void 0===t?void 0:t.toString()))})),this.lobby_room.addEventListener("viewer_player",(e=>{var t;this.socket.send(T(`client-${this.connection_metadata.client_id}`,"room-set-viewer",e.detail.toString(),null===(t=this.connection_metadata.room_id)||void 0===t?void 0:t.toString()))})),this.lobby_room.addEventListener("player_player",(e=>{var t;this.socket.send(T(`client-${this.connection_metadata.client_id}`,"room-set-player",e.detail.toString(),null===(t=this.connection_metadata.room_id)||void 0===t?void 0:t.toString()))})),this.lobby_room.addEventListener("promote_player",(e=>{var t;this.socket.send(T(`client-${this.connection_metadata.client_id}`,"room-promote",e.detail.toString(),null===(t=this.connection_metadata.room_id)||void 0===t?void 0:t.toString()))})),this.lobby_room.addEventListener("save_settings",(e=>{this.socket.send(e.detail)})),this.lobby_room.addEventListener("launch_game",(()=>{var e;this.socket.send(T(`client-${this.connection_metadata.client_id}`,"room-launch","",null===(e=this.connection_metadata.room_id)||void 0===e?void 0:e.toString()))})),this.lobby_room.addEventListener("rejoin_game",(()=>{this.dispatchEvent(new CustomEvent("rejoin_game",{detail:this.lobby_room.room}))})),this.refreshLobbyRooms(),this.lobby_users.refreshUsers(),setInterval((()=>{this.pingServer()}),5e3)}setSocket(e){this.socket&&this.socket.close(3e3,"opening new connection"),this.waitingOnConnectedTimes=2,this.socket=e,this.refreshLobbyRooms(),this.lobby_users.refreshUsers(),this.socket.addEventListener("message",(e=>{try{!function(e,t){var n,i,o,s,a,r;if(e.socketActive())if(r=t.kind,["room","lobby","ping"].every((e=>!r.startsWith(`${e}-`))))console.log("not a lobby message",t);else switch("ping-update"!==t.kind&&console.log(t),t.kind){case"lobby-you-joined":const r=parseInt(t.data);if(r){e.connection_metadata.client_id=r,e.classList.add("connected"),e.setNickname(t.content),e.chatbox.addChat({message:`You (${t.content}) joined lobby with client id ${r}`,sender:L}),e.lobby_users.addUser({client_id:r,nickname:e.connection_metadata.nickname,ping:0});try{localStorage.setItem("client_id",t.data),localStorage.setItem("client_nickname",t.content),localStorage.setItem("client_id_time",Date.now().toString())}catch(e){}e.refreshLobbyRooms()}else e.socket.close(3001,"you-joined-lobby message did not return properly formed client id"),e.dispatchEvent(new Event("connection_lost"));break;case"lobby-joined":const d=parseInt(t.data);d&&(e.chatbox.addChat({message:`${t.content} joined lobby with client id ${d}`,sender:L}),e.lobby_users.addUser({client_id:d,nickname:t.content,ping:0}));break;case"lobby-left":const l=parseInt(t.data);if(l){e.chatbox.addChat({message:`${t.content} (client id ${l}) left lobby`,sender:L});const i=e.lobby_users.getUser(l);e.lobby_users.removeUser(l),e.lobby_rooms.userDisconnected(l),i&&i.room_id===e.connection_metadata.room_id&&i.client_id===(null===(n=e.lobby_room.getHost())||void 0===n?void 0:n.client_id)?e.leaveRoom():e.lobby_room.leaveRoom(l,"disconnected from")}break;case"lobby-chat":const c=parseInt(t.sender.replace("client-",""));c&&e.chatbox.addChat({message:t.content,sender:null!==(o=null===(i=e.lobby_users.getUser(c))||void 0===i?void 0:i.nickname)&&void 0!==o?o:c.toString(),color:t.data});break;case"ping-update":const m=parseInt(t.data),h=parseInt(t.content);m&&!isNaN(h)&&(e.connection_metadata.client_id===m&&e.setPing(h),e.lobby_room.updatePing(m,h),e.lobby_users.updatePing(m,h));break;case"room-created":const g=(t,n)=>{e.lobby_rooms.addRoom(t),e.connection_metadata.client_id===n&&(e.enterRoom(t,!0),setTimeout((()=>{e.create_room_button.innerText="Room Created"}),1))};try{const n=parseInt(t.sender.replace("client-","")),i=e.lobby_users.getUser(n),o=$(JSON.parse(t.content));i.room_id=o.room_id,g.bind(this,o,n)()}catch(e){parseInt(t.data)}break;case"room-closed":const u=parseInt(t.data);if(u){e.connection_metadata.room_id===u&&e.leaveRoom();const t=e.lobby_rooms.getRoom(u);if(e.lobby_rooms.removeRoom(u),t)for(const n of t.players.keys())e.lobby_users.leaveRoom(n)}break;case"room-left":const p=parseInt(t.sender.replace("room-","")),b=parseInt(t.data.replace("client-",""));p&&b&&e.userLeftRoom(p,b,"left");break;case"room-joined-player":const _=parseInt(t.sender.replace("room-","")),y=parseInt(t.data.replace("client-","")),v=e.lobby_users.getUser(y),f=e.lobby_rooms.getRoom(_);_&&y&&v&&f&&(e.lobby_users.joinRoom(y,_),e.lobby_rooms.playerJoinsRoom(_,v),_===e.connection_metadata.room_id?e.lobby_room.joinRoom(v,!0):y===e.connection_metadata.client_id&&f&&e.enterRoom(e.lobby_rooms.getRoom(_),!1));break;case"room-joined-viewer":const w=parseInt(t.sender.replace("room-","")),x=parseInt(t.data.replace("client-","")),k=e.lobby_users.getUser(x),E=e.lobby_rooms.getRoom(w);w&&x&&k&&E&&(e.lobby_users.joinRoom(x,w),e.lobby_rooms.viewerJoinsRoom(w,k),w===e.connection_metadata.room_id?e.lobby_room.joinRoom(k,!1):x===e.connection_metadata.client_id&&E&&e.enterRoom(e.lobby_rooms.getRoom(w),!1));break;case"room-chat":const S=t.sender.split("-");if(S.length<3)break;const T=parseInt(S[1]),C=parseInt(S[2]);if(T&&C&&e.connection_metadata.room_id===T&&e.lobby_room.hasPlayer(C)){let n=null!==(a=null===(s=e.lobby_room.getClient(C))||void 0===s?void 0:s.nickname)&&void 0!==a?a:C.toString();S.length>3&&(n=S[3]),e.lobby_room.chatbox.addChat({message:t.content,sender:n,color:t.data})}break;case"room-renamed":const R=parseInt(t.sender.replace("room-","")),I=parseInt(t.data);R&&I&&(e.connection_metadata.client_id,e.lobby_room.room&&e.lobby_room.room.room_id===R&&e.lobby_room.renameRoom(t.content,I),e.lobby_rooms.renameRoom(R,t.content));break;case"room-kicked":const U=parseInt(t.sender.replace("room-","")),Z=parseInt(t.data);U&&Z&&e.userLeftRoom(U,Z,"was kicked from");break;case"room-promoted":const P=parseInt(t.sender.replace("room-","")),j=parseInt(t.data);P&&j&&(P===e.connection_metadata.room_id&&e.lobby_room.promoteUser(j,j===e.connection_metadata.client_id),e.lobby_rooms.promoteUser(P,j));break;case"room-viewer-set":const A=parseInt(t.sender.replace("room-","")),z=parseInt(t.data);A&&z&&(A===e.connection_metadata.room_id&&e.lobby_room.playerToViewer(z),e.lobby_rooms.playerToViewer(A,z));break;case"room-player-set":const N=parseInt(t.sender.replace("room-","")),M=parseInt(t.data);N&&M&&(N===e.connection_metadata.room_id&&e.lobby_room.viewerToPlayer(M),e.lobby_rooms.viewerToPlayer(N,M));break;case"room-settings-updated":try{const n=parseInt(t.sender.replace("room-","")),i=JSON.parse(t.data);e.lobby_rooms.updateRoomSettings(n,i),n===e.connection_metadata.room_id&&e.lobby_room.updateSettings(i)}catch(e){}break;case"room-launched":const D=parseInt(t.sender.replace("room-","")),O=parseInt(t.data);D&&O&&(e.lobby_rooms.launchRoom(D,O),D===e.connection_metadata.room_id&&(e.lobby_room.launchRoom(O),e.dispatchEvent(new CustomEvent("game_launched",{detail:e.lobby_room.room}))));break;case"room-join-failed":case"room-refresh-failed":case"room-leave-failed":case"room-rename-failed":case"room-kick-failed":case"room-promote-failed":case"room-set-player-failed":case"room-set-viewer-failed":case"room-settings-updated-failed":case"room-launch-failed":const H=document.createElement("dwg-message-dialog");H.setData({message:t.content}),e.appendChild(H),console.log(t.content),e.refreshLobbyRooms();break;default:console.log("Unknown message type",t.kind,"from",t.sender)}}(this,JSON.parse(e.data))}catch(t){console.log("Error parsing message: ",e,t)}}))}userLeftRoom(e,t,n){e===this.connection_metadata.room_id&&(this.lobby_room.leaveRoom(t,n),t===this.connection_metadata.client_id&&this.leaveRoom()),this.lobby_users.leaveRoom(t),this.lobby_rooms.clientLeavesRoom(e,t)}socketActive(){return!!this.socket&&this.socket.readyState==WebSocket.OPEN}setNickname(e){this.connection_metadata.nickname=e,this.name_container.innerText=e}setPing(e){this.connection_metadata.ping=e,this.ping_container.innerText=`ping: ${Math.round(e)}`}refreshLobbyRooms(){var e,t;return le(this,void 0,void 0,(function*(){const n=yield this.lobby_rooms.refreshRooms(null!==(e=this.connection_metadata.client_id)&&void 0!==e?e:-1);n?this.enterRoom(n,n.host.client_id===(null!==(t=this.connection_metadata.client_id)&&void 0!==t?t:-1)):this.leaveRoom()}))}enterRoom(e,t){this.connection_metadata.room_id=e.room_id,this.lobby_room.setRoom(e,t),this.lobby_room_wrapper.classList.add("show")}leaveRoom(){this.connection_metadata.room_id=void 0,this.lobby_room_wrapper.classList.remove("show"),this.lobby_room.clearRoom(),this.create_room_button.disabled=!1,this.create_room_button.innerText="Create Room"}sendChatMessage(e,t,n,i){let o=!1;try{this.socketActive()&&(this.socket.send(T(n.sender,t,n.message,n.color)),o=!0),o?e.addChat(Object.assign(Object.assign({},n),{sender:i}),!0):e.addChat({message:`Message unable to be sent: "${n.message}"`,color:"gray"},!0)}catch(t){e.addChat({message:"Error trying to send message",color:"gray"},!0)}}pingServer(){var e,t;if(!this.classList.contains("connector-open")){if(this.socketActive()||this.dispatchEvent(new Event("connected_lost")),!this.classList.contains("connected"))return this.waitingOnConnectedTimes--,void(this.waitingOnConnectedTimes<1&&this.dispatchEvent(new Event("connection_lost")));this.waitingOnConnectedTimes=2,this.lobby_users.refreshUsers(),this.lobby_room_wrapper.classList.contains("show")&&this.socket.send(T(`client-${this.connection_metadata.client_id}`,"room-refresh","",(null!==(t=null===(e=this.lobby_room.room)||void 0===e?void 0:e.room_id)&&void 0!==t?t:0).toString()))}}});var ce=new URL(n(621),n.b),me=new URL(n(637),n.b),he=new URL(n(449),n.b);const ge='<div id="header"> <div id="client-name"> <span id="client-name-string"></span> <span id="client-ping"></span> </div> <div id="room-name"></div> <div id="game-name"></div> <div id="button-container"> <button id="button-game-history"> <img src="'+N()(ce)+'" alt="rename" draggable="false"> </button> <button id="button-room-players"> <img src="'+N()(me)+'" alt="players" draggable="false"> </button> <button id="button-exit"> <img src="'+N()(he)+'" alt="close" draggable="false"> </button> </div> </div> <div id="waiting-room"> <div id="players-waiting"></div> </div> <div id="game-container"></div> <div id="chatbox-container"> <dwg-chatbox id="chatbox" class="transparent-fade"></dwg-chatbox> </div>';var ue=n(415),pe={};function be(e){switch(e){case 1:return"Diamond";case 2:return"Club";case 3:return"Heart";case 4:return"Spade";default:return"error"}}function _e(e){if(e>1&&e<11)return e.toString();switch(e){case 11:return"jack";case 12:return"queen";case 13:return"king";case 14:return"ace";default:return"error"}}function ye(e){return`${_e(e.number)} of ${be(e.suit)}s`}function ve(e){let t=`${_e(e.number).toLowerCase()}_of_${be(e.suit).toLowerCase()}s`;return e.number>10&&e.number<14&&(t+="2"),`/cards/${t}.png`}pe.styleTagTransform=h(),pe.setAttributes=d(),pe.insert=a().bind(null,"head"),pe.domAPI=o(),pe.insertStyleElement=c(),t()(ue.Z,pe),ue.Z&&ue.Z.locals&&ue.Z.locals;var fe=n(713),we={};we.styleTagTransform=h(),we.setAttributes=d(),we.insert=a().bind(null,"head"),we.domAPI=o(),we.insertStyleElement=c(),t()(fe.Z,we),fe.Z&&fe.Z.locals&&fe.Z.locals;var xe=new URL(n(496),n.b);const ke='<div id="card-played-container"> <img alt="Card Played" id="card-played"> </div> <div id="card-played-coverer"></div> <div id="name-container-wrapper"> <span id="name-container"></span><span id="dealer-container">&nbsp;(dealer)</span> </div> <div> <span class="fixed-width">Score:</span><span id="score-container"></span></div> <div> <span class="fixed-width">Bet:</span><span id="bet-container"></span> </div> <div> <span class="fixed-width">Tricks:</span><span id="tricks-container"></span> </div> <div id="cards-container"></div> <div id="betting-container"> <input type="number" id="bet-input" min="0" max="0"> <button id="bet-button">Bet</button> </div> <img id="winner-icon" alt="winner" src="'+N()(xe)+'">';var Ee=n(494),Le={};Le.styleTagTransform=h(),Le.setAttributes=d(),Le.insert=a().bind(null,"head"),Le.domAPI=o(),Le.insertStyleElement=c(),t()(Ee.Z,Le),Ee.Z&&Ee.Z.locals&&Ee.Z.locals,customElements.define("dwg-fiddlesticks-player",class extends x{constructor(){super(),this.client_player=!1,this.card_els=[],this.currently_playing=!1,this.initialized=!1,this.htmlString=ke,this.configureElement("name_container"),this.configureElement("dealer_container"),this.configureElement("score_container"),this.configureElement("bet_container"),this.configureElement("tricks_container"),this.configureElement("cards_container"),this.configureElement("betting_container"),this.configureElement("bet_input"),this.configureElement("bet_button"),this.configureElement("card_played_container"),this.configureElement("card_played"),this.configureElement("winner_icon")}parsedCallback(){if(!this.initialized)throw new Error("Should initialize fiddlesticks player before attaching to dom");this.name_container.innerText=this.player.player.nickname,this.score_container.innerText=this.player.score.toString(),this.bet_container.innerText="-",this.tricks_container.innerText="-"}initialize(e){this.player=e,this.initialized=!0}gameStarted(e,t){e?(this.bet_container.innerText=this.player.bet.toString(),this.tricks_container.innerText="-",t&&this.betting()):(this.bet_container.innerText=this.player.bet.toString(),this.tricks_container.innerText=this.player.tricks.toString(),t&&this.playing())}setClientPlayer(){this.classList.add("client-player"),this.client_player=!0,this.bet_button.addEventListener("click",(()=>{this.bet_button.disabled=!0;const e=T(`player-${this.player.player.player_id}`,"game-update",`{"amount":${this.bet_input.value}}`,"bet");this.dispatchEvent(new CustomEvent("game_update",{detail:e,bubbles:!0}))}))}setDealer(e){this.dealer_container.classList.toggle("show",e)}newRound(){this.player.bet=-1,this.player.tricks=0,this.bet_container.innerText="-",this.tricks_container.innerText="-"}setHiddenCards(e){this.newRound(),this.player.cards=[],this.card_els=[]}setCards(e){this.newRound(),this.player.cards=e,this.card_els=[];for(const[t,n]of e.entries()){const e=document.createElement("div");e.classList.add("card"),e.innerText=ye(n),this.cards_container.appendChild(e);const i=document.createElement("img");i.classList.add("card-img"),i.src=ve(n),e.appendChild(i),this.card_els.push(e),e.addEventListener("click",(()=>{if(!this.currently_playing)return;this.currently_playing=!1;const e=T(`player-${this.player.player.player_id}`,"game-update",`{"index":${t}}`,"play-card");this.dispatchEvent(new CustomEvent("game_update",{detail:e,bubbles:!0}))}))}}betting(){this.client_player&&(this.bet_button.disabled=!1,this.bet_input.valueAsNumber=0,this.bet_input.max=this.player.cards.length.toString(),this.betting_container.classList.add("show"))}setBet(e){this.client_player&&this.betting_container.classList.remove("show"),this.player.bet=e,this.bet_container.innerText=e.toString()}endBetting(){this.tricks_container.innerText="0"}playing(){this.client_player&&(this.currently_playing=!0)}playCard(e,t){this.client_player&&(this.currently_playing=!1),this.card_els.length&&this.card_els[e].remove(),this.card_played.src=ve(t),this.card_played_container.classList.add("show")}endTrick(e){this.player.tricks=e,this.tricks_container.innerText=e.toString(),this.card_played_container.classList.remove("show")}setScore(e){this.player.score=e,this.score_container.innerText=e.toString()}wonGame(){this.winner_icon.classList.add("show")}});var Se=n(125),Te={};Te.styleTagTransform=h(),Te.setAttributes=d(),Te.insert=a().bind(null,"head"),Te.domAPI=o(),Te.insertStyleElement=c(),t()(Se.Z,Te),Se.Z&&Se.Z.locals&&Se.Z.locals;class Ce extends x{constructor(){super(),this.htmlString='<div id="content-container"></div> ',this.configureElement("content_container")}connectedCallback(){const e=Object.create(null,{connectedCallback:{get:()=>super.connectedCallback}});return t=this,n=void 0,o=function*(){e.connectedCallback.call(this),yield _((()=>(this.content_container=this.querySelector("#content-container"),!!this.content_container))),this.classList.add("dwg-dialog-box"),this.content_container.innerHTML=this.getHTML()},new((i=void 0)||(i=Promise))((function(e,s){function a(e){try{d(o.next(e))}catch(e){s(e)}}function r(e){try{d(o.throw(e))}catch(e){s(e)}}function d(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,r)}d((o=o.apply(t,n||[])).next())}));var t,n,i,o}parsedCallback(){this.setData(this.getData(),!0)}closeDialog(){this.remove()}}var Re=n(411),Ie={};Ie.styleTagTransform=h(),Ie.setAttributes=d(),Ie.insert=a().bind(null,"head"),Ie.domAPI=o(),Ie.insertStyleElement=c(),t()(Re.Z,Ie),Re.Z&&Re.Z.locals&&Re.Z.locals,customElements.define("dwg-message-dialog",class extends Ce{constructor(){super(),this.configureElement("message_container"),this.configureElement("ok_button")}getHTML(){return'<div id="wrapper"> <div id="message-container"></div> <button id="ok-button">ok</button> </div> '}getData(){var e,t;return{message:null!==(e=this.getAttribute("message"))&&void 0!==e?e:"",button_text:null!==(t=this.getAttribute("button_text"))&&void 0!==t?t:void 0}}setData(e,t){this.setAttribute("message",e.message),e.button_text&&this.setAttribute("button_text",e.button_text),(t||this.fully_parsed)&&(this.message_container.innerText=e.message,e.button_text&&(this.ok_button.innerText=e.button_text),this.ok_button.addEventListener("click",(()=>{this.closeDialog()})))}}),customElements.define("dwg-fiddlesticks",class extends x{constructor(){super(),this.current_trick=0,this.player_els=[],this.player_id=-1,this.htmlString='<div id="table-container"> <div id="header-message"> <div>Round: <span id="round-number"></span></div> <div>Trick: <span id="trick-number"></span></div> <div>Status: <span id="status-container"></span></div> </div> <div id="trump-card-container"> <div>Trump Card</div> <div id="trump-card"><img id="trump-card-img" alt="Trump Card"></div> </div> <div id="trick-cards"></div> </div> <div id="player-container"></div>',this.configureElement("round_number"),this.configureElement("trick_number"),this.configureElement("status_container"),this.configureElement("trump_card_img"),this.configureElement("trick_cards"),this.configureElement("player_container")}parsedCallback(){this.round_number.innerText="-",this.trick_number.innerText="-",this.status_container.innerText="Starting game ..."}initialize(e,t){this.game=e,this.player_els=[];for(const[n,i]of e.players.entries()){const e=document.createElement("dwg-fiddlesticks-player");e.initialize(i),this.player_container.appendChild(e),this.player_els.push(e),i.player.client_id===t&&(this.player_id=n,e.setClientPlayer())}if(e.game_base.game_started){this.round_number.innerText=e.round.toString();for(const[t,n]of this.player_els.entries())n.gameStarted(e.betting,!e.game_base.game_ended&&t===e.turn),this.player_id!=t||e.game_base.game_ended||n.setCards(e.players[t].cards);e.betting?(this.current_trick=0,this.trick_number.innerText="-"):(this.current_trick=e.players.reduce(((e,t)=>e+t.tricks),1),this.trick_number.innerText=this.current_trick.toString()),e.game_base.game_ended||(this.trump_card_img.src=ve(e.trump))}}gameUpdate(e){try{switch(e.kind){case"deal-round":const t=e.update;this.round_number.innerText=t.round.toString(),this.trump_card_img.src=ve(t.trump),this.game.trump=t.trump;for(const[e,n]of this.player_els.entries())t.dealer===e?n.setDealer(!0):n.setDealer(!1),e===this.player_id?n.setCards(t.cards):n.setHiddenCards(t.round);this.game.betting=!0,this.game.dealer=t.dealer,this.game.round=t.round,this.trick_number.innerText="-",this.current_trick=0,this.game.round===this.game.max_round&&(this.game.rounds_increasing=!1),this.game.turn=this.game.dealer+1,this.game.turn>=this.game.players.length&&(this.game.turn-=this.game.players.length),this.game.trick_leader=this.game.turn;for(const[e,n]of this.game.players.entries())n.bet=-1,e===this.player_id?n.cards=t.cards:n.cards=[],n.tricks=0;this.game.turn===this.player_id&&this.player_els[this.player_id].betting(),this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Betting`;break;case"bet":const n=e.update;if(this.game.turn!==n.player_id)throw new Error("Player bet out of order");this.game.players[n.player_id].bet=n.amount,this.player_els[n.player_id].setBet(n.amount);let i=this.game.turn!==this.game.dealer;if(this.game.turn++,this.game.turn>=this.game.players.length&&(this.game.turn-=this.game.players.length),i)this.player_els[this.game.turn].betting(),this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Betting`;else{this.game.trick_leader=this.game.turn,this.trick_number.innerText="1",this.current_trick=1,this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Playing`;for(const[e,t]of this.player_els.entries())t.endBetting(),e===this.game.turn&&t.playing()}break;case"play-card":const o=e.update;if(this.game.turn!==o.player_id)throw new Error("Player played out of order");if(this.player_id===o.player_id&&this.game.players[o.player_id].cards.splice(o.index,1),this.game.trick.push(o.card),this.player_els[o.player_id].playCard(o.index,o.card),this.game.turn++,this.game.turn>=this.game.players.length&&(this.game.turn-=this.game.players.length),this.game.turn===this.game.trick_leader){let e=0,t=this.game.trick[0];for(let n=1;n<this.game.trick.length;n++){const i=this.game.trick[n];i.suit===t.suit?i.number>t.number&&(e=n,t=i):i.suit===this.game.trump.suit&&(e=n,t=i)}this.game.turn=this.game.trick_leader+e,this.game.turn>=this.game.players.length&&(this.game.turn-=this.game.players.length),this.game.trick_leader=this.game.turn,this.game.players[this.game.turn].tricks++;for(const[e,t]of this.player_els.entries())t.endTrick(this.game.players[e].tricks);if(this.game.trick=[],console.log(`Trick won by ${this.game.players[this.game.turn].player.nickname} with the ${ye(t)}`),this.current_trick===this.game.round){for(const[e,t]of this.game.players.entries())t.bet===t.tricks&&(t.score+=this.game.round_points+this.game.trick_points*t.bet,this.player_els[e].setScore(t.score)),this.player_els[e].newRound();if(this.game.rounds_increasing&&this.game.round===this.game.max_round&&(this.game.rounds_increasing=!1),this.game.rounds_increasing||1!==this.game.round)this.game.rounds_increasing?this.game.round++:this.game.round--;else{this.game.game_base.game_ended=!0;let e=[0],t=this.game.players[0].score;for(let n=1;n<this.game.players.length;n++){const i=this.game.players[n];i.score>t?(e=[n],t=i.score):i.score===t&&e.push(n)}for(const t of e)this.player_els[t].wonGame();let n=e.length>1?"The winners are: ":"The winner is: ";n+=e.map((e=>this.game.players[e].player.nickname)).join(", "),n+=`\nWith ${t} points`;const i=document.createElement("dwg-message-dialog");i.setData({message:n}),this.appendChild(i)}}else this.current_trick++,this.trick_number.innerText=this.current_trick.toString(),this.player_els[this.game.turn].playing(),this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Playing`}else this.player_els[this.game.turn].playing(),this.status_container.innerText=`${this.game.players[this.game.turn].player.nickname} Playing`;break;case"play-card-failed":const s=e.update;this.player_id===s.player_id&&this.player_els[s.player_id].playing();break;default:console.log(`Unknown game update type ${e.kind}`)}}catch(t){console.log(`Error during game update ${JSON.stringify(e)}: ${t}`)}}});var $e=new URL(n(449),n.b);const Ue='<div id="wrapper"> <button id="close-button"> <img src="'+N()($e)+'" alt="close" draggable="false"> </button> <div id="updates-container"></div> </div>';var Ze=n(365),Pe={};Pe.styleTagTransform=h(),Pe.setAttributes=d(),Pe.insert=a().bind(null,"head"),Pe.domAPI=o(),Pe.insertStyleElement=c(),t()(Ze.Z,Pe),Ze.Z&&Ze.Z.locals&&Ze.Z.locals,customElements.define("dwg-game-history-dialog",class extends Ce{constructor(){super(),this.configureElement("close_button"),this.configureElement("updates_container")}getHTML(){return Ue}getData(){return this.data}setData(e,t){if(this.data=e,!t&&!this.fully_parsed)return;const n=[...e.updates.values()].sort(((e,t)=>e.update_id-t.update_id));for(const e of n){const t=document.createElement("div");t.innerText=`ID: ${e.update_id}, Kind: ${e.kind}, data: ${JSON.stringify(e.update)}`,this.updates_container.append(t)}this.close_button.addEventListener("click",(()=>{this.closeDialog()}))}});var je=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function a(e){try{d(i.next(e))}catch(e){s(e)}}function r(e){try{d(i.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}d((i=i.apply(e,t||[])).next())}))};customElements.define("dwg-game",class extends x{constructor(){super(),this.players_waiting_els=new Map,this.game_id=0,this.htmlString=ge,this.configureElement("client_name_string"),this.configureElement("client_ping"),this.configureElement("room_name"),this.configureElement("game_name"),this.configureElement("waiting_room"),this.configureElement("players_waiting"),this.configureElement("game_container"),this.configureElement("chatbox_container"),this.configureElement("chatbox"),this.configureElement("button_game_history"),this.configureElement("button_room_players"),this.configureElement("button_exit")}parsedCallback(){document.addEventListener("keyup",(e=>{"Enter"===e.key&&(this.chatbox_container.classList.toggle("showing"),this.chatbox.classList.toggle("show"),this.chatbox.classList.contains("show")&&this.chatbox.focus())})),this.chatbox.addEventListener("chat_sent",(e=>{var t;const n=e.detail;this.socket.send(T(null!==(t=n.sender)&&void 0!==t?t:`game-${this.connection_metadata.client_id}`,"game-chat",n.message,n.color))})),this.button_game_history.addEventListener("click",(()=>{var e;if(!this.launched)return;const t=document.createElement("dwg-game-history-dialog");t.setData({updates:null!==(e=this.game.game_base.updates)&&void 0!==e?e:new Map}),this.appendChild(t)})),this.button_room_players.addEventListener("click",(()=>{})),this.button_exit.addEventListener("click",(()=>{this.dispatchEvent(new Event("exit_game"))})),setInterval((()=>{this.pingServer()}),2500)}launchGame(e,t,n,i=!1){return je(this,void 0,void 0,(function*(){if((!this.launched||i)&&e&&e.game_id&&t&&t.readyState===WebSocket.OPEN&&n&&n.client_id&&n.room_id&&e.room_id===n.room_id){this.socket=t,this.connection_metadata=n,this.client_name_string.innerText=this.connection_metadata.nickname,this.client_ping.innerText=` (${this.connection_metadata.ping})`,this.room_name.innerText=e.room_name,this.game_id=e.game_id;try{return this.socket.addEventListener("message",(e=>{try{!function(e,t){var n,i,o,s,a,r,d,l,c;if(e.socketActive())if(c=t.kind,["game","ping"].every((e=>!c.startsWith(`${e}-`))))console.log("not a game message",t);else switch("ping-update"!==t.kind&&console.log(t),t.kind){case"ping-update":break;case"game-chat":const c=parseInt(t.sender.replace("game-",""));if(c){const d=null!==(o=null===(i=null===(n=e.game)||void 0===n?void 0:n.game_base)||void 0===i?void 0:i.players.get(c))&&void 0!==o?o:null===(a=null===(s=e.game)||void 0===s?void 0:s.game_base)||void 0===a?void 0:a.viewers.get(c);e.chatbox.addChat({message:t.content,sender:null!==(r=d.nickname)&&void 0!==r?r:c.toString()})}break;case"game-player-connected":const m=parseInt(t.data);if(m){const t=e.players_waiting_els.get(m);t&&(t.innerText="Connected",t.classList.add("connected"));const n=null===(l=null===(d=e.game)||void 0===d?void 0:d.game_base)||void 0===l?void 0:l.players.get(m);n&&(n.connected=!0)}break;case"game-start":e.startGame();break;case"game-update":!function(e,t){const n=t.sender.split("-");if(n.length<3)return;const i=parseInt(n[2]);if(i)try{const n=JSON.parse(t.content),o={update_id:i,kind:t.data,update:n};if(e.game.game_base.updates.set(i,o),i-1===e.game.game_base.last_continuous_update_id)for(e.game.game_base.last_continuous_update_id=i,console.log(`applying update id ${o.update_id}`),e.game_el.gameUpdate(o);e.game.game_base.updates.has(e.game.game_base.last_continuous_update_id+1);){const t=e.game.game_base.updates.get(e.game.game_base.last_continuous_update_id+1);e.game.game_base.last_continuous_update_id=t.update_id,console.log(`applying update id ${t.update_id}`),e.game_el.gameUpdate(t)}else i-1>e.game.game_base.last_continuous_update_id&&e.socket.send(T(`client-${e.connection_metadata.client_id}`,"game-get-update","",`${e.game.game_base.last_continuous_update_id+1}`))}catch(t){console.log(t),e.socket.send(T(`client-${e.connection_metadata.client_id}`,"game-get-update","",`${i}`))}}(e,t);break;case"game-connected-failed":case"game-update-failed":case"game-get-update-failed":console.log(t.content),e.refreshGame();break;default:console.log("Unknown message type",t.kind,"from",t.sender)}}(this,JSON.parse(e.data))}catch(t){console.log("Error parsing message: ",e,t)}})),yield this.refreshGame()}catch(e){console.log(e)}return!1}console.log("Invalid state to launch game")}))}socketActive(){return!!this.socket&&this.socket.readyState==WebSocket.OPEN}refreshGame(){return je(this,void 0,void 0,(function*(){const e=yield function(e,t){return P(this,void 0,void 0,(function*(){const n=t instanceof File,i=n?t.type:"application/json",o=n?t.name:void 0,s=n?t:JSON.stringify(t);try{const t=yield fetch(j(e),{method:"POST",headers:{"Content-Type":i,"X-File-Name":o},body:s});return yield t.json()}catch(e){console.log(e)}return{success:!1,error_message:"Server error; please report this bug."}}))}(`lobby/games/get/${this.game_id}`,{client_id:this.connection_metadata.client_id,viewer:"false"});if(!e.success||!e.result)return console.log(e.error_message),!1;this.game=function(e,t){var n,i,o;const s=new Map(e.game_base.players.map((e=>[e.client_id,e]))),a=new Map(e.game_base.viewers.map((e=>[e.client_id,e]))),r=Object.assign(Object.assign({},e),{game_base:{game_id:e.game_base.game_id,game_type:e.game_base.game_type,game_started:e.game_base.game_started,game_ended:e.game_base.game_ended,players:s,viewers:a,player_actions:e.game_base.player_actions?new Map(e.game_base.player_actions.map((e=>[e.action_id,e]))):void 0}}),d=null!==(i=null===(n=s.get(t))||void 0===n?void 0:n.updates)&&void 0!==i?i:null===(o=a.get(t))||void 0===o?void 0:o.updates;return void 0!==d&&(r.game_base.updates=new Map(d.map((e=>[e.update_id,e]))),r.game_base.last_continuous_update_id=d.length),r}(e.result,this.connection_metadata.client_id);const t=e=>{const t=document.createElement(e);this.game_container.replaceChildren(t),this.game_el=t,this.game_el.initialize(this.game,this.connection_metadata.client_id),t.addEventListener("game_update",(e=>{console.log("Sending game update",e.detail),this.socket.send(e.detail)}))};switch(this.game.game_base.game_type){case R.FIDDLESTICKS:t("dwg-fiddlesticks");break;case R.UNSPECIFIED:default:throw new Error(`Unknown game type: ${this.game.game_base.game_type}`)}if(this.game_name.innerText=y(R[this.game.game_base.game_type].toLowerCase()),this.game.game_base.game_started)this.startGame();else{this.waiting_room.classList.remove("hide"),this.game_container.classList.remove("show");for(const[e,t]of this.game.game_base.players){const n=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div");n.appendChild(i),n.appendChild(o),n.classList.add("player-waiting"),i.innerText=t.nickname,o.innerText=t.connected?"Connected":"Connecting ...",t.connected&&o.classList.add("connected"),this.players_waiting_els.set(e,o),this.players_waiting.appendChild(n)}}return this.classList.add("show"),this.socket.send(T(`client-${this.connection_metadata.client_id}`,"game-connected","",this.game_id.toString())),this.launched=!0,!0}))}startGame(){this.game.game_base.game_started=!0,this.waiting_room.classList.add("hide"),this.game_container.classList.add("show")}pingServer(){var e,t;this.socketActive()&&((null===(t=null===(e=this.game)||void 0===e?void 0:e.game_base)||void 0===t?void 0:t.game_started)?this.socket.send(T(`client-${this.connection_metadata.client_id}`,"game-resend-last-update")):this.socket.send(T(`client-${this.connection_metadata.client_id}`,"game-resend-waiting-room")))}});var Ae=n(11),ze={};ze.styleTagTransform=h(),ze.setAttributes=d(),ze.insert=a().bind(null,"head"),ze.domAPI=o(),ze.insertStyleElement=c(),t()(Ae.Z,ze),Ae.Z&&Ae.Z.locals&&Ae.Z.locals,customElements.define("dwg-lobby-connector",class extends x{constructor(){super(),this.submitted=new Event("submitted"),this.invalid_names=[L],this.htmlString='<div id="card"> <input id="nickname" placeholder="Nickname"> <button id="connect-button">Connect to Lobby</button> <div id="status-message"></div> </div> ',this.configureElement("card"),this.configureElement("nickname"),this.configureElement("connect_button"),this.configureElement("status_message")}parsedCallback(){this.connect_button.disabled=!0;try{const e=localStorage.getItem("client_nickname");e&&(this.nickname.value=e,this.validateName())}catch(e){}this.nickname.addEventListener("keyup",(e=>{this.validateName()&&"Enter"===e.key&&this.dispatchEvent(this.submitted)})),v(this.connect_button,(()=>(this.dispatchEvent(this.submitted),"Connecting ...")),{re_enable_button:!1})}validateName(){if(this.invalid_names.includes(this.nickname.value))return!1;const e=this.nickname.value.length>1&&this.nickname.value.length<17;return this.connect_button.disabled=!e,e}});var Ne=n(706),Me={};Me.styleTagTransform=h(),Me.setAttributes=d(),Me.insert=a().bind(null,"head"),Me.domAPI=o(),Me.insertStyleElement=c(),t()(Ne.Z,Me),Ne.Z&&Ne.Z.locals&&Ne.Z.locals;var De=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function a(e){try{d(i.next(e))}catch(e){s(e)}}function r(e){try{d(i.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}d((i=i.apply(e,t||[])).next())}))};customElements.define("dwg-page-home",class extends x{constructor(){super(),this.htmlString='<dwg-lobby id="lobby" class="connector-open"></dwg-lobby> <dwg-game id="game"></dwg-game> <dwg-lobby-connector id="lobby-connector"></dwg-lobby-connector>',this.configureElement("lobby"),this.configureElement("game"),this.configureElement("lobby_connector")}parsedCallback(){this.lobby_connector.addEventListener("submitted",(()=>{const e=this.lobby_connector.nickname.value;let t=0,n=0;try{t=parseInt(localStorage.getItem("client_id_time")),n=parseInt(localStorage.getItem("client_id"))}catch(e){}const i=n&&t&&Date.now()-t<864e5?new WebSocket(`ws://${location.hostname}:6807/api/lobby/reconnect/${e}/${n}`):new WebSocket(`ws://${location.hostname}:6807/api/lobby/connect/${e}`);i.addEventListener("error",(e=>{console.log(e),this.tryConnectionAgain("Could not connect. Check your connection and try again.")})),i.addEventListener("open",(()=>{this.lobby_connector.classList.add("hide"),this.lobby.classList.remove("connector-open"),this.lobby.setNickname(e),this.lobby.setPing(0),this.lobby.setSocket(i)}))})),this.lobby.addEventListener("connection_lost",(()=>{this.tryConnectionAgain("Connection was lost. Check your connection and try again.")})),this.lobby.addEventListener("game_launched",(e=>De(this,void 0,void 0,(function*(){(yield this.game.launchGame(e.detail,this.lobby.socket,this.lobby.connection_metadata))&&this.lobby.classList.add("hide")})))),this.lobby.addEventListener("rejoin_game",(e=>De(this,void 0,void 0,(function*(){(yield this.game.launchGame(e.detail,this.lobby.socket,this.lobby.connection_metadata,!0))&&this.lobby.classList.add("hide")})))),this.game.addEventListener("exit_game",(()=>{this.game.classList.remove("show"),this.lobby.classList.remove("hide")}))}tryConnectionAgain(e){this.lobby.classList.remove("connected"),this.lobby_connector.classList.remove("hide"),this.lobby.classList.add("connector-open"),this.lobby_connector.status_message.innerText=e,this.lobby_connector.connect_button.disabled=!1,this.lobby_connector.connect_button.innerText="Reconnect to Lobby"}})})()})();