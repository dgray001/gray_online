(()=>{"use strict";var e={59:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,"dwg-chatbox{--input-box-height: 35px;background-color:#c8c8c8;color:#000;display:block;height:100%;width:100%}dwg-chatbox #chat-container{display:flex;flex-flow:column nowrap;height:calc(100% - var(--input-box-height));width:100%}dwg-chatbox #chat-container :first-child{margin-top:auto}dwg-chatbox #chat-container>.color-gray{color:#646464}dwg-chatbox #input-container{--margin: 8px;--send-button-width: 70px;display:flex;flex-flow:row nowrap;height:var(--input-box-height);width:100%}dwg-chatbox #input-container>*{box-sizing:border-box;height:calc(100% - var(--margin));margin-top:var(--margin)}dwg-chatbox #input-container #chat-input{width:calc(100% - var(--send-button-width))}dwg-chatbox #input-container #send-chat{width:var(--send-button-width)}",""]);const a=i},630:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,".dwg-element:not(.parsed){display:none}",""]);const a=i},732:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,"dwg-lobby{--name-header-height: 30px;--buttons-height: 50px;--chat-height: 200px;background-color:#143c78;display:flex;flex-flow:column nowrap}dwg-lobby #name-header{background-color:#001e3c;box-sizing:border-box;display:block;font-size:18px;height:var(--name-header-height);line-height:var(--name-header-height);max-height:var(--name-header-height);min-height:var(--name-header-height);padding-left:1.5em;width:100%}dwg-lobby #buttons{background-color:#0a3264;border-bottom:2px solid #000;box-sizing:border-box;display:flex;flex-flow:row nowrap;gap:8px;height:var(--buttons-height);max-height:var(--buttons-height);min-height:var(--buttons-height);width:100%}dwg-lobby #buttons>button{background-color:rgba(0,0,0,0);border:none;border-radius:16px;color:#fff;font-size:20px;padding:8px;transition:background-color 200ms,border-radius 200ms}dwg-lobby #buttons>button:hover:not(:disabled){background-color:rgba(50,100,200,.2)}dwg-lobby #buttons>button:active:not(:disabled){background-color:rgba(70,140,250,.4);border-radius:0px}dwg-lobby #buttons>button:disabled{background-color:rgba(150,150,150,.6);border-radius:8px;transition:none}dwg-lobby #horizontal-container{display:flex;flex-flow:row nowrap;flex:1 0 0;width:100%}dwg-lobby #horizontal-container #vertical-container{display:flex;flex-flow:column nowrap;flex:1 0 0;height:100%}dwg-lobby #horizontal-container #vertical-container #lobby-rooms{box-sizing:border-box;flex:1 0 0;padding:12px}dwg-lobby #horizontal-container #vertical-container #chatbox{box-sizing:border-box;height:var(--chat-height);max-height:var(--chat-height);min-height:var(--chat-height);padding:12px}dwg-lobby #horizontal-container #lobby-users{background-color:#0a1e32;box-sizing:border-box;height:100%;padding:8px;width:250px}dwg-lobby #lobby-room-wrapper{background-color:rgba(150,150,150,.5);bottom:0;left:0;position:absolute;right:0;top:0}dwg-lobby #lobby-room-wrapper:not(.show){display:none}dwg-lobby #lobby-room-wrapper #lobby-room{box-sizing:border-box;height:60vh;margin:20vh auto;padding:8px;width:60vw}",""]);const a=i},11:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,"dwg-lobby-connector{background-color:rgba(120,120,120,.8);height:100%;left:0px;position:absolute;top:0px;width:100%;z-index:2}dwg-lobby-connector.hide{display:none}dwg-lobby-connector #card{background-color:#dcdcdc;color:#000;height:200px;left:calc(50% - 100px);padding:16px;position:relative;top:calc(50% - 150px);width:300px}dwg-lobby-connector #card #nickname{font-size:24px;margin-top:20px;width:290px}dwg-lobby-connector #card #connect-button{font-size:24px;margin-top:50px;width:290px}",""]);const a=i},991:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,"dwg-lobby-room{background-color:#5ab4fa;box-shadow:0px 0px 3px 4px rgba(70,140,210,.8),0px 0px 6px 8px rgba(50,100,170,.8),0px 0px 9px 12px rgba(30,60,130,.8);display:flex;flex-flow:column nowrap;gap:8px}dwg-lobby-room:not(.show){display:none}dwg-lobby-room #room-header{background-color:#3c78d2;display:flex;flex-flow:row nowrap;height:36px;width:100%}dwg-lobby-room #room-header #room-name{flex:1 0 0;font-size:24px;height:100%;line-height:36px;padding-left:8px}dwg-lobby-room #room-header #room-name:not(.show){display:none}dwg-lobby-room #room-header #rename-input{box-sizing:border-box;flex:1 0 0;font-size:24px;height:100%;line-height:36px;padding-left:8px}dwg-lobby-room #room-header #rename-input:not(.show){display:none}dwg-lobby-room #room-header #rename-room:not(.show){display:none}dwg-lobby-room #room-header #cancel-rename{font-size:18px;width:80px}dwg-lobby-room #room-header #cancel-rename:not(.show){display:none}dwg-lobby-room #room-header>button{background-color:rgba(0,0,0,0);border:none;border-radius:6px;height:100%;margin:0px;padding:0px;width:36px}dwg-lobby-room #room-header>button:hover{background-color:rgba(220,220,220,.5)}dwg-lobby-room #room-header>button:active{background-color:rgba(220,220,220,.8)}dwg-lobby-room #room-body{display:flex;flex-flow:row nowrap;flex:1 0 0;width:100%}dwg-lobby-room #room-body #user-list{background-color:#1e5ab4;height:100%;width:250px}",""]);const a=i},562:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,"dwg-lobby-rooms>.lobby-room{font-size:18px;height:26px;line-height:26px;padding:2px;user-select:none;width:100%}dwg-lobby-rooms>.lobby-room:hover{background-color:rgba(180,180,180,.15)}dwg-lobby-rooms>.lobby-room:active{background-color:rgba(180,180,180,.3)}",""]);const a=i},391:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,"dwg-lobby-users{display:flex;flex-flow:column nowrap}dwg-lobby-users #header{height:36px}dwg-lobby-users #header #refresh-button{background-color:rgba(0,0,0,0);border:none;border-radius:6px;height:30px;margin:0px;padding:0px;position:relative;top:3px;user-select:none;width:30px}dwg-lobby-users #header #refresh-button:hover{background-color:rgba(180,180,180,.15)}dwg-lobby-users #header #refresh-button:active{background-color:rgba(180,180,180,.3)}dwg-lobby-users #header #refresh-button #refresh-img{filter:invert(1);left:3px;position:absolute;top:3px;user-select:none}dwg-lobby-users #user-container{display:flex;flex-flow:column nowrap;flex:1 0 0}dwg-lobby-users #user-container .lobby-user{box-sizing:border-box;font-size:16px;height:22px;padding:2px;user-select:none;width:100%}dwg-lobby-users #user-container .lobby-user:hover{background-color:rgba(180,180,180,.15)}dwg-lobby-users #user-container .lobby-user:active{background-color:rgba(180,180,180,.3)}dwg-lobby-users #user-container .lobby-user.left{text-decoration:line-through}",""]);const a=i},706:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,"dwg-page-home{--margin-size: 16px;--height: calc(100vh - 2 * var(--margin-size));--width: calc(100% - 2 * var(--margin-size));background-color:#05285a;display:block;height:var(--height);max-height:var(--height);max-width:var(--width);min-height:var(--height);min-width:var(--width);padding:var(--margin-size);width:var(--width)}dwg-page-home #lobby{height:100%;width:100%}",""]);const a=i},197:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,"",""]);const a=i},99:(e,t,o)=>{o.d(t,{Z:()=>a});var n=o(81),r=o.n(n),s=o(645),i=o.n(s)()(r());i.push([e.id,'body{background-color:#000;color:#fff;font-family:"Fira Sans",sans-serif;margin:0;min-height:100vh;min-width:100%;padding:0}',""]);const a=i},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var o="",n=void 0!==t[5];return t[4]&&(o+="@supports (".concat(t[4],") {")),t[2]&&(o+="@media ".concat(t[2]," {")),n&&(o+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),o+=e(t),n&&(o+="}"),t[2]&&(o+="}"),t[4]&&(o+="}"),o})).join("")},t.i=function(e,o,n,r,s){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(n)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(i[c]=!0)}for(var d=0;d<e.length;d++){var l=[].concat(e[d]);n&&i[l[0]]||(void 0!==s&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=s),o&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=o):l[2]=o),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),t.push(l))}},t}},81:e=>{e.exports=function(e){return e[1]}},91:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),t.hash&&(e+=t.hash),t.maybeNeedQuotes&&/[\t\n\f\r "'=<>`]/.test(e)?'"'.concat(e,'"'):e):e}},379:e=>{var t=[];function o(e){for(var o=-1,n=0;n<t.length;n++)if(t[n].identifier===e){o=n;break}return o}function n(e,n){for(var s={},i=[],a=0;a<e.length;a++){var c=e[a],d=n.base?c[0]+n.base:c[0],l=s[d]||0,h="".concat(d," ").concat(l);s[d]=l+1;var b=o(h),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==b)t[b].references++,t[b].updater(m);else{var u=r(m,n);n.byIndex=a,t.splice(a,0,{identifier:h,updater:u,references:1})}i.push(h)}return i}function r(e,t){var o=t.domAPI(t);return o.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;o.update(e=t)}else o.remove()}}e.exports=function(e,r){var s=n(e=e||[],r=r||{});return function(e){e=e||[];for(var i=0;i<s.length;i++){var a=o(s[i]);t[a].references--}for(var c=n(e,r),d=0;d<s.length;d++){var l=o(s[d]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}s=c}}},569:e=>{var t={};e.exports=function(e,o){var n=function(e){if(void 0===t[e]){var o=document.querySelector(e);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(e){o=null}t[e]=o}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(o)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,o)=>{e.exports=function(e){var t=o.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(o){!function(e,t,o){var n="";o.supports&&(n+="@supports (".concat(o.supports,") {")),o.media&&(n+="@media ".concat(o.media," {"));var r=void 0!==o.layer;r&&(n+="@layer".concat(o.layer.length>0?" ".concat(o.layer):""," {")),n+=o.css,r&&(n+="}"),o.media&&(n+="}"),o.supports&&(n+="}");var s=o.sourceMap;s&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,o)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},474:(e,t,o)=>{e.exports=o.p+"5c0badfd21808b14f424.png"},255:(e,t,o)=>{e.exports=o.p+"c3cb371e1616269849ad.png"},861:(e,t,o)=>{e.exports=o.p+"8787734a93d781fa44ad.png"}},t={};function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={id:n,exports:{}};return e[n](s,s.exports,o),s.exports}o.m=e,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.p="dist/",o.b=document.baseURI||self.location.href,o.nc=void 0,(()=>{var e=o(379),t=o.n(e),n=o(795),r=o.n(n),s=o(569),i=o.n(s),a=o(565),c=o.n(a),d=o(216),l=o.n(d),h=o(589),b=o.n(h),m=o(99),u={};u.styleTagTransform=b(),u.setAttributes=c(),u.insert=i().bind(null,"head"),u.domAPI=r(),u.insertStyleElement=l(),t()(m.Z,u),m.Z&&m.Z.locals&&m.Z.locals;var g=o(197),p={};function f(e,t,o={}){const n=Object.assign({loading_text:void 0,disable_button:!0,re_enable_button:!0},o);e.addEventListener("click",(()=>{function o(t,o){"string"==typeof t&&(e.innerText=t),o&&(e.disabled=!1)}n.disable_button&&(e.disabled=!0),e.innerText,o(n.loading_text);const r=t();r instanceof Promise?r.then((e=>{o(e,n.re_enable_button)})):o(r,n.re_enable_button)}))}p.styleTagTransform=b(),p.setAttributes=c(),p.insert=i().bind(null,"head"),p.domAPI=r(),p.insertStyleElement=l(),t()(g.Z,p),g.Z&&g.Z.locals&&g.Z.locals;var y=o(630),v={};v.styleTagTransform=b(),v.setAttributes=c(),v.insert=i().bind(null,"head"),v.domAPI=r(),v.insertStyleElement=l(),t()(y.Z,v),y.Z&&y.Z.locals&&y.Z.locals;class _ extends HTMLElement{constructor(){super(...arguments),this.fully_parsed=!1,this.elsMetadata=[]}connectedCallback(){return e=this,t=void 0,n=function*(){this.classList.add("dwg-element"),this.innerHTML=this.htmlString,yield function(e,t=300){const o=n=>{e()?n():setTimeout((()=>o(n)),t)};return new Promise(o)}(this.elementsParsed.bind(this)),this.parsedCallback(),this.classList.add("parsed"),this.fully_parsed=!0},new((o=void 0)||(o=Promise))((function(r,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}));var e,t,o,n}elementsParsed(){let e=!0;for(const t of this.elsMetadata){let o=t.found_element?this[t.name]:null;t.found_element||(o=this.querySelector(`#${t.element_id}`),o&&(this[t.name]=o,t.found_element=!0)),t.found_element?o instanceof _&&(o.fully_parsed||(e=!1)):e=!1}return e}parsedCallback(){}configureElement(e,t){t||(t=e.replace(/_/g,"-")),this.elsMetadata.push({element_id:t,name:e})}}function w(e,t){return o=this,n=void 0,s=function*(){const o=t instanceof File,n=o?t.type:"application/json",r=o?t.name:void 0,s=o?t:JSON.stringify(t);try{const t=yield fetch(function(e){return`/api/${e}/`}(e),{method:"POST",headers:{"Content-Type":n,"X-File-Name":r},body:s});return yield t.json()}catch(e){console.log(e)}return{success:!1,error_message:"Server error; please report this bug."}},new((r=void 0)||(r=Promise))((function(e,t){function i(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r((function(e){e(o)}))).then(i,a)}c((s=s.apply(o,n||[])).next())}));var o,n,r,s}function x(e,t,o,n){return JSON.stringify({sender:e,kind:t,content:o,data:n})}function k(e){var t;return{client_id:parseInt(e.client_id),nickname:e.nickname,room_id:null!==(t=parseInt(e.room_id))&&void 0!==t?t:void 0}}var E=o(732),R={};R.styleTagTransform=b(),R.setAttributes=c(),R.insert=i().bind(null,"head"),R.domAPI=r(),R.insertStyleElement=l(),t()(E.Z,R),E.Z&&E.Z.locals&&E.Z.locals;var C=o(59),L={};L.styleTagTransform=b(),L.setAttributes=c(),L.insert=i().bind(null,"head"),L.domAPI=r(),L.insertStyleElement=l(),t()(C.Z,L),C.Z&&C.Z.locals&&C.Z.locals,customElements.define("dwg-chatbox",class extends _{constructor(){super(),this.htmlString='<div id="chat-container"></div> <div id="input-container"> <input id="chat-input" placeholder=""> <button id="send-chat">Send</button> </div>',this.configureElement("chat_container"),this.configureElement("chat_input"),this.configureElement("send_chat")}parsedCallback(){f(this.send_chat,(()=>{this.sendChat()})),this.chat_input.addEventListener("keyup",(e=>{"Enter"===e.key&&this.sendChat()}))}addChat(e){const t="server"===e.sender||"gray"===e.color?'<div class="color-gray">':"<div>",o=e.sender&&"server"!==e.sender?`${e.sender}: `:"";this.chat_container.innerHTML+=`${t}${o}${e.message}</div>`}sendChat(){if(this.inputEmpty())return;const e=new CustomEvent("chat_sent",{detail:this.getInput()});this.dispatchEvent(e)}setPlaceholder(e){this.chat_input.placeholder=e}clear(){this.chat_input.value="",this.chat_container.innerHTML=""}inputEmpty(){return!this.chat_input.value}getInput(){const e={message:this.chat_input.value};return this.chat_input.value="",e}});var T=o(91),Z=o.n(T),S=new URL(o(861),o.b);const $='<div id="header"> <button id="refresh-button"> <img id="refresh-img" src="'+Z()(S)+'" alt="refresh" draggable="false"> </button> </div> <div id="user-container"></div>';var I=o(391),M={};M.styleTagTransform=b(),M.setAttributes=c(),M.insert=i().bind(null,"head"),M.domAPI=r(),M.insertStyleElement=l(),t()(I.Z,M),I.Z&&I.Z.locals&&I.Z.locals;customElements.define("dwg-lobby-users",class extends _{constructor(){super(),this.users=new Map,this.refresh_users_running=!1,this.htmlString=$,this.configureElement("refresh_button"),this.configureElement("user_container")}parsedCallback(){f(this.refresh_button,(()=>{this.refreshUsers()}),{}),this.refreshUsers()}refreshUsers(){return e=this,t=void 0,n=function*(){if(this.refresh_users_running)return;this.refresh_users_running=!0,this.user_container.innerHTML=" ... loading",this.users.clear();const e=yield w("lobby/users/get","");if(e.success){console.log(e);let t="";for(const o of e.result){const e=k(o);t+=this.addUserString(e),this.users.set(e.client_id,e)}this.user_container.innerHTML=t}else this.user_container.innerHTML=`Error loading users: ${e.error_message}`;this.refresh_users_running=!1},new((o=void 0)||(o=Promise))((function(r,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}));var e,t,o,n}addUserString(e){return`<div class="lobby-user" id="user-${e.client_id}">${e.nickname} (${e.client_id})</div>`}addUser(e){if(this.users.has(e.client_id)){const t=this.querySelector(`#user-${e.client_id}`);t&&t.replaceWith(this.addUserString(e))}else this.user_container.innerHTML+=this.addUserString(e);this.users.set(e.client_id,e)}removeUser(e){this.users.delete(e.client_id);const t=this.querySelector(`#user-${e.client_id}`);t&&t.classList.add("left")}getUser(e){return this.users.get(e)}joinRoom(e,t){const o=this.getUser(e);o&&(o.room_id=t)}leaveRoom(e){const t=this.getUser(e);t&&(t.room_id=void 0)}});var A=o(562),z={};z.styleTagTransform=b(),z.setAttributes=c(),z.insert=i().bind(null,"head"),z.domAPI=r(),z.insertStyleElement=l(),t()(A.Z,z),A.Z&&A.Z.locals&&A.Z.locals;customElements.define("dwg-lobby-rooms",class extends _{constructor(){super(),this.rooms=new Map,this.refresh_rooms_running=!1,this.htmlString=""}parsedCallback(){}refreshRooms(){return e=this,t=void 0,n=function*(){if(this.refresh_rooms_running)return;this.refresh_rooms_running=!0,this.innerHTML=" ... loading",this.rooms.clear();const e=yield w("lobby/rooms/get","");if(e.success){const o=[];for(const n of e.result){const e=(t=n,{room_id:parseInt(t.room_id),room_name:t.room_name,host:k(t.host),users:new Map(t.users.map((e=>{const t=k(e);return[t.client_id,t]})))});o.push(this.getRoomElement(e)),this.rooms.set(e.room_id,e)}this.innerHTML="";for(const e of o)this.appendChild(e)}else this.innerHTML=`Error loading rooms: ${e.error_message}`;var t;this.refresh_rooms_running=!1},new((o=void 0)||(o=Promise))((function(r,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}));var e,t,o,n}getRoomElement(e){const t=document.createElement("div");return t.classList.add("lobby-room"),t.id=`room-${e.room_id}`,t.innerText=e.room_name,t.addEventListener("click",(()=>{this.dispatchEvent(new CustomEvent("join_room",{detail:e.room_id}))})),t}addRoom(e){if(this.rooms.has(e.room_id)){const t=this.querySelector(`#room-${e.room_id}`);t&&t.replaceWith(this.getRoomElement(e))}else this.appendChild(this.getRoomElement(e));this.rooms.set(e.room_id,e)}removeRoom(e){this.rooms.delete(e);const t=this.querySelector(`#room-${e}`);t&&t.remove()}getRoom(e){return this.rooms.get(e)}clientJoinsRoom(e,t){const o=this.getRoom(t.room_id);o&&(o.host.client_id===t.client_id?this.removeRoom(t.room_id):o.users.delete(t.client_id));const n=this.getRoom(e);n&&n.users.set(t.client_id,t)}clientLeavesRoom(e,t){const o=this.getRoom(e);o&&(o.host.client_id===t?this.removeRoom(e):o.users.delete(t))}});var P=new URL(o(255),o.b),U=new URL(o(474),o.b);const j='<div id="room-header"> <button id="rename-room"> <img src="'+Z()(P)+'" alt="rename" draggable="false"> </button> <button id="cancel-rename">cancel</button> <div id="room-name"></div> <input id="rename-input" placeholder="room name"> <button id="leave-room"> <img src="'+Z()(U)+'" alt="close" draggable="false"> </button> </div> <div id="room-body"> <div id="user-list"></div> <dwg-chatbox id="chatbox"></dwg-chatbox> </div>';var N=o(991),H={};H.styleTagTransform=b(),H.setAttributes=c(),H.insert=i().bind(null,"head"),H.domAPI=r(),H.insertStyleElement=l(),t()(N.Z,H),N.Z&&N.Z.locals&&N.Z.locals,customElements.define("dwg-lobby-room",class extends _{constructor(){super(),this.is_host=!1,this.htmlString=j,this.configureElement("room_name"),this.configureElement("user_list"),this.configureElement("chatbox"),this.configureElement("leave_room"),this.configureElement("rename_input"),this.configureElement("rename_room"),this.configureElement("cancel_rename")}parsedCallback(){this.chatbox.setPlaceholder("Chat with room"),this.chatbox.addEventListener("chat_sent",(e=>{this.dispatchEvent(new CustomEvent("chat_sent",{detail:e.detail}))})),this.leave_room.addEventListener("click",(()=>{this.dispatchEvent(new Event("leave_room"))})),this.rename_room.addEventListener("click",(()=>{this.openRename()})),this.cancel_rename.addEventListener("click",(()=>{this.cancelRename()})),this.rename_input.addEventListener("keyup",(e=>{"Enter"===e.key&&this.submitRename()})),this.room_name.classList.add("show")}setRoom(e,t){this.is_host=t,this.room=e,this.room_name.innerText=e.room_name,this.classList.add("show"),t&&this.rename_room.classList.add("show")}clearRoom(){this.room=void 0,this.chatbox.clear(),this.classList.remove("show")}hasClient(e){return!(!this.classList.contains("show")||!this.room)&&this.room.users.has(e)}getClient(e){if(this.classList.contains("show")&&this.room)return this.room.users.get(e)}joinRoom(e){this.room&&this.room.users.set(e.client_id,e)}leaveRoom(e){this.room.host.client_id===e?this.clearRoom():this.room.users.delete(e)}openRename(){this.rename_room.classList.remove("show"),this.room_name.classList.remove("show"),this.rename_input.value=this.room.room_name,this.rename_input.classList.add("show"),this.cancel_rename.classList.add("show")}cancelRename(){this.rename_room.classList.add("show"),this.room_name.classList.add("show"),this.rename_input.classList.remove("show"),this.cancel_rename.classList.remove("show")}submitRename(){this.dispatchEvent(new CustomEvent("rename_room",{detail:this.rename_input.value})),this.cancelRename()}});var O=function(e,t,o,n){return new(o||(o=Promise))((function(r,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))};customElements.define("dwg-lobby",class extends _{constructor(){super(),this.connection_metadata={nickname:"Anonymous"},this.connection_lost=new Event("connection_lost"),this.htmlString='<span id="name-header"></span> <span id="buttons"> <button id="refresh-lobby-button">Refresh</button> <button id="create-room-button">Create Room</button> </span> <span id="horizontal-container"> <span id="vertical-container"> <dwg-lobby-rooms id="lobby-rooms"></dwg-lobby-rooms> <dwg-chatbox id="chatbox"></dwg-chatbox> </span> <dwg-lobby-users id="lobby-users"></dwg-lobby-users> </span> <div id="lobby-room-wrapper"> <dwg-lobby-room id="lobby-room"></dwg-lobby-room> </div>',this.configureElement("name_header"),this.configureElement("refresh_lobby_button"),this.configureElement("create_room_button"),this.configureElement("lobby_rooms"),this.configureElement("chatbox"),this.configureElement("lobby_users"),this.configureElement("lobby_room_wrapper"),this.configureElement("lobby_room")}parsedCallback(){this.chatbox.setPlaceholder("Chat with the entire lobby"),f(this.refresh_lobby_button,(()=>O(this,void 0,void 0,(function*(){yield this.lobby_rooms.refreshRooms()})))),f(this.create_room_button,(()=>O(this,void 0,void 0,(function*(){return(yield w(`lobby/rooms/create/${this.connection_metadata.client_id}`,"")).success?"Joining Room ...":(setTimeout((()=>{this.create_room_button.disabled=!1,this.create_room_button.innerText="Create Room"}),1e3),"Error Creating Room")}))),{loading_text:"Creating Room ...",re_enable_button:!1}),this.lobby_rooms.addEventListener("join_room",(e=>O(this,void 0,void 0,(function*(){const t=e.detail,o=yield w(`lobby/rooms/join/${t}/${this.connection_metadata.client_id}`,"");o.success||console.log("Error joining room:",o.error_message)})))),this.chatbox.addEventListener("chat_sent",(e=>{this.sendChatMessage(this.chatbox,"client","lobby-chat",e.detail)})),this.lobby_room.addEventListener("chat_sent",(e=>{const t=e.detail;t.sender=`room-${this.connection_metadata.room_id}-${this.connection_metadata.client_id}`,this.sendChatMessage(this.lobby_room.chatbox,"room","room-chat",t)})),this.lobby_room.addEventListener("leave_room",(()=>O(this,void 0,void 0,(function*(){const e=yield w(`lobby/rooms/leave/${this.connection_metadata.room_id}/${this.connection_metadata.client_id}`,"");e.success||(console.log("Error leaving room:",e.error_message),this.leaveRoom())})))),this.lobby_room.addEventListener("rename_room",(e=>{})),this.lobby_rooms.refreshRooms()}setSocket(e){this.socket&&this.socket.close(3e3,"opening new connection"),this.socket=e,this.socket.addEventListener("message",(e=>{try{const t=JSON.parse(e.data);this.handleMessage(t)}catch(t){console.log("Error parsing message: ",e,t)}}))}handleMessage(e){var t,o,n,r;if(this.socketActive())switch(console.log(e),e.kind){case"lobby-you-joined":const s=parseInt(e.data);s?(this.connection_metadata.client_id=s,this.setNickname(e.content),this.chatbox.addChat({message:`You (${this.connection_metadata.nickname}) joined lobby with client id ${s}`,sender:"server"}),this.socket.send(x(`client-${s}`,"lobby-join",this.connection_metadata.nickname,`${s}`)),this.lobby_users.addUser({client_id:s,nickname:this.connection_metadata.nickname})):(this.socket.close(3001,"you-joined-lobby message did not return properly formed client id"),this.dispatchEvent(this.connection_lost));break;case"lobby-join":const i=parseInt(e.data);i&&(this.chatbox.addChat({message:`${e.content} joined lobby with client id ${i}`,sender:"server"}),this.lobby_users.addUser({client_id:i,nickname:e.content}));break;case"lobby-left":const a=parseInt(e.data);a&&(this.chatbox.addChat({message:`${e.content} (client id ${a}) left lobby`,sender:"server"}),this.lobby_users.removeUser({client_id:a,nickname:e.content}));break;case"lobby-chat":const c=parseInt(e.sender.replace("client-",""));c&&this.chatbox.addChat({message:e.content,sender:null!==(o=null===(t=this.lobby_users.getUser(c))||void 0===t?void 0:t.nickname)&&void 0!==o?o:c.toString()});break;case"room-created":const d=parseInt(e.data),l=parseInt(e.content),h=this.lobby_users.getUser(l);if(d&&l&&h){const e={room_id:d,room_name:`${h.nickname}'s room`,host:h,users:new Map};e.users.set(h.client_id,h),this.lobby_rooms.addRoom(e),this.connection_metadata.client_id===l&&(this.enterRoom(e,!0),setTimeout((()=>{this.create_room_button.innerText="Room Created"}),1))}break;case"room-closed":const b=parseInt(e.data);if(b){this.connection_metadata.room_id===b&&this.leaveRoom();const e=this.lobby_rooms.getRoom(b);if(this.lobby_rooms.removeRoom(b),e)for(const t of e.users.keys())this.lobby_users.leaveRoom(t)}break;case"room-leave":const m=parseInt(e.sender.replace("room-","")),u=parseInt(e.data.replace("client-",""));m&&u&&(m===this.connection_metadata.room_id&&(this.lobby_room.leaveRoom(u),u===this.connection_metadata.client_id&&this.leaveRoom()),this.lobby_users.leaveRoom(u),this.lobby_rooms.clientLeavesRoom(m,u));break;case"room-join":const g=parseInt(e.sender.replace("room-","")),p=parseInt(e.data.replace("client-","")),f=this.lobby_users.getUser(p),y=this.lobby_rooms.getRoom(g);g&&p&&f&&(g===this.connection_metadata.room_id?this.lobby_room.joinRoom(f):p===this.connection_metadata.client_id&&y&&this.enterRoom(y,!1),this.lobby_users.joinRoom(p,g),this.lobby_rooms.clientJoinsRoom(g,f));break;case"room-chat":const v=e.sender.split("-");if(v.length<3)break;const _=parseInt(v[1]),w=parseInt(v[2]);_&&w&&this.connection_metadata.room_id===_&&this.lobby_room.hasClient(w)&&this.lobby_room.chatbox.addChat({message:e.content,sender:null!==(r=null===(n=this.lobby_room.getClient(w))||void 0===n?void 0:n.nickname)&&void 0!==r?r:w.toString()});break;default:console.log("Unknown message type",e.kind,"from",e.sender)}}socketActive(){return!!this.socket&&this.socket.readyState==WebSocket.OPEN}setNickname(e){this.connection_metadata.nickname=e,this.name_header.innerText=e}enterRoom(e,t){this.connection_metadata.room_id=e.room_id,this.lobby_room.setRoom(e,t),this.lobby_room_wrapper.classList.add("show")}leaveRoom(){this.connection_metadata.room_id=void 0,this.lobby_room_wrapper.classList.remove("show"),this.lobby_room.clearRoom(),this.create_room_button.disabled=!1,this.create_room_button.innerText="Create Room"}sendChatMessage(e,t,o,n){var r;let s=!1;try{this.socketActive()&&(this.socket.send(x(null!==(r=n.sender)&&void 0!==r?r:`${t}-${this.connection_metadata.client_id}`,o,n.message,n.color)),s=!0),s?e.addChat(Object.assign(Object.assign({},n),{sender:this.connection_metadata.nickname})):e.addChat({message:`Message unable to be sent: "${n.message}"`,color:"gray"})}catch(t){e.addChat({message:"Error trying to send message",color:"gray"})}}});var J=o(11),q={};q.styleTagTransform=b(),q.setAttributes=c(),q.insert=i().bind(null,"head"),q.domAPI=r(),q.insertStyleElement=l(),t()(J.Z,q),J.Z&&J.Z.locals&&J.Z.locals,customElements.define("dwg-lobby-connector",class extends _{constructor(){super(),this.submitted=new Event("submitted"),this.htmlString='<div id="card"> <input id="nickname" placeholder="Nickname"> <button id="connect-button">Connect to Lobby</button> <div id="status-message"></div> </div> ',this.configureElement("card"),this.configureElement("nickname"),this.configureElement("connect_button"),this.configureElement("status_message")}parsedCallback(){this.connect_button.disabled=!0,this.nickname.addEventListener("keyup",(e=>{const t=this.validName(this.nickname.value);this.connect_button.disabled=!t,t&&"Enter"===e.key&&this.dispatchEvent(this.submitted)})),f(this.connect_button,(()=>(this.dispatchEvent(this.submitted),"Connecting ...")),{re_enable_button:!1})}validName(e){return!!e.length}});var F=o(706),W={};W.styleTagTransform=b(),W.setAttributes=c(),W.insert=i().bind(null,"head"),W.domAPI=r(),W.insertStyleElement=l(),t()(F.Z,W),F.Z&&F.Z.locals&&F.Z.locals,customElements.define("dwg-page-home",class extends _{constructor(){super(),this.htmlString='<dwg-lobby id="lobby"></dwg-lobby> <dwg-lobby-connector id="lobby-connector"></dwg-lobby-connector>',this.configureElement("lobby"),this.configureElement("lobby_connector")}parsedCallback(){this.lobby_connector.addEventListener("submitted",(()=>{const e=this.lobby_connector.nickname.value,t=new WebSocket(`ws://127.0.0.1:6807/api/lobby/connect/${e}`);t.addEventListener("error",(e=>{console.log(e),this.tryConnectionAgain("Could not connect. Check your connection and try again.")})),t.addEventListener("open",(()=>{this.lobby.setSocket(t),this.lobby.connection_metadata.nickname=e,this.lobby.name_header.innerText=e,this.lobby_connector.classList.add("hide")}))})),this.lobby.addEventListener("connection_lost",(()=>{this.tryConnectionAgain("Connection was lost. Check your connection and try again.")}))}tryConnectionAgain(e){this.lobby_connector.classList.remove("hide"),this.lobby_connector.status_message.innerText=e,this.lobby_connector.connect_button.disabled=!1,this.lobby_connector.connect_button.innerText="Connect to Lobby"}})})()})();